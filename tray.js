const { Tray, Menu, dialog, shell, BrowserWindow, ipcMain, app, Notification } = require('electron');
const { spawn, exec } = require('child_process');
const { spawn: crossSpawn } = require('cross-spawn');
const fs = require('fs');
const mustache = require('mustache');
const path = require('path');
const os = require('os');
const https = require('https');
const extract = require('extract-zip');
const mainModule = require('./main');

const baseDir = __dirname;
let processes = {};
let progressWindow = null;
let downloadStartTime = null;

let appSettings = {
  autoStart: true,
  hideTaskbar: true,
  hardwareAccel: true,
  notifications: true
};

// ÿ•ÿπÿØÿßÿØ IPC handlers ŸÑŸÑÿ™ŸÅÿßÿπŸÑ ŸÖÿπ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function setupIpcHandlers() {
  // ŸÖÿπÿßŸÑÿ¨ÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
  ipcMain.handle('settings-get', (event, key) => {
    return appSettings[key];
  });

  ipcMain.handle('settings-set', (event, key, value) => {
    appSettings[key] = value;
    saveSettings();
    return true;
  });

  ipcMain.handle('settings-get-all', () => {
    return appSettings;
  });

  // ŸÖÿπÿßŸÑÿ¨ÿßÿ™ ÿßŸÑÿÆÿØŸÖÿßÿ™
  ipcMain.handle('service-start', (event, serviceName) => {
    if (serviceName === 'apache') {
      startApache();
    } else if (serviceName === 'mysql') {
      startMySQL();
    }
    return true;
  });

  ipcMain.handle('service-stop', (event, serviceName) => {
    stopService(serviceName);
    return true;
  });

  ipcMain.handle('service-status', (event, serviceName) => {
    return isServiceRunning(serviceName);
  });

  ipcMain.handle('service-restart', (event, serviceName) => {
    stopService(serviceName);
    setTimeout(() => {
      if (serviceName === 'apache') {
        startApache();
      } else if (serviceName === 'mysql') {
        startMySQL();
      }
    }, 2000);
    return true;
  });

  // ŸÖÿπÿßŸÑÿ¨ÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ
  ipcMain.handle('system-platform', () => {
    return process.platform;
  });

  ipcMain.handle('system-version', () => {
    return os.release();
  });

  ipcMain.handle('app-version', () => {
    return app.getVersion();
  });

  // ŸÖÿπÿßŸÑÿ¨ÿßÿ™ ÿßŸÑŸÜŸàÿßŸÅÿ∞
  ipcMain.handle('window-minimize', (event) => {
    const window = BrowserWindow.fromWebContents(event.sender);
    window.minimize();
  });

  ipcMain.handle('window-close', (event) => {
    const window = BrowserWindow.fromWebContents(event.sender);
    window.hide();
  });

  ipcMain.handle('window-hide', (event) => {
    const window = BrowserWindow.fromWebContents(event.sender);
    window.hide();
  });

  ipcMain.handle('window-show', (event) => {
    const window = BrowserWindow.fromWebContents(event.sender);
    window.show();
  });

  // ŸÖÿπÿßŸÑÿ¨ÿßÿ™ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
  ipcMain.handle('notification-show', (event, title, body, options = {}) => {
    if (appSettings.notifications) {
      showNotification(title, body, options);
    }
  });

  // ŸÖÿπÿßŸÑÿ¨ÿßÿ™ phpMyAdmin
  ipcMain.handle('phpmyadmin-is-installed', () => {
    return isPhpMyAdminInstalled();
  });

  ipcMain.handle('phpmyadmin-install', () => {
    downloadPhpMyAdmin();
  });

  ipcMain.handle('phpmyadmin-remove', () => {
    removePhpMyAdmin();
  });

  ipcMain.handle('phpmyadmin-open', () => {
    openPhpMyAdmin();
  });

  // ŸÖÿπÿßŸÑÿ¨ÿßÿ™ ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ≥ÿ±Ÿäÿπ
  ipcMain.handle('quick-install', (event, appType, projectName) => {
    return performQuickInstall(appType, projectName);
  });

  ipcMain.handle('quick-install-list', () => {
    return Object.keys(quickInstallApps).map(key => ({
      id: key,
      ...quickInstallApps[key]
    }));
  });

  ipcMain.handle('check-requirements', (event, requirements) => {
    return checkRequirements(requirements);
  });
}

// ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function saveSettings() {
  const settingsPath = path.join(baseDir, 'config', 'settings.json');
  try {
    fs.writeFileSync(settingsPath, JSON.stringify(appSettings, null, 2));
  } catch (error) {
    console.error('Error saving settings:', error);
  }
}

// ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function loadSettings() {
  const settingsPath = path.join(baseDir, 'config', 'settings.json');
  try {
    if (fs.existsSync(settingsPath)) {
      const data = fs.readFileSync(settingsPath, 'utf8');
      appSettings = { ...appSettings, ...JSON.parse(data) };
    }
  } catch (error) {
    console.error('Error loading settings:', error);
  }
}

// ÿ•ÿ∏Ÿáÿßÿ± ÿ•ÿ¥ÿπÿßÿ± ŸÜÿ∏ÿßŸÖ
function showNotification(title, body, options = {}) {
  if (Notification.isSupported()) {
    const notification = new Notification({
      title: title,
      body: body,
      icon: path.join(baseDir, 'assets', 'icon.png'),
      ...options
    });
    
    notification.show();
    
    if (options.onClick) {
      notification.on('click', options.onClick);
    }
  }
}

// ÿØÿßŸÑÿ© ŸÑŸÇÿ™ŸÑ ÿπŸÖŸÑŸäÿßÿ™ Apache ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ©
async function killExistingApacheProcesses() {
    return new Promise((resolve) => {
        console.log('üî™ Killing existing Apache processes...');
        
        // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ cmd ŸÖÿπ WMIC ÿ£ŸàŸÑÿßŸã (ÿ£ŸÇŸàŸâ ŸÖŸÜ taskkill)
        exec('cmd /c "wmic process where \\"name=\'httpd.exe\'\\" delete"', (error, stdout, stderr) => {
            if (error) {
                if (error.message.includes('not found')) {
                    console.log('‚ÑπÔ∏è No Apache processes found to kill');
                } else {
                    console.log('‚ö†Ô∏è Error killing Apache processes:', error.message);
                }
            } else {
                console.log('‚úÖ Apache processes killed:', stdout.trim());
            }
            
            // ŸÇÿ™ŸÑ ÿ£Ÿä ÿπŸÖŸÑŸäÿßÿ™ ÿ£ÿ®ÿßÿ™ÿ¥Ÿä ÿ£ÿÆÿ±Ÿâ
            exec('cmd /c "wmic process where \\"name=\'apache.exe\'\\" delete"', (error2, stdout2, stderr2) => {
                if (error2) {
                    if (!error2.message.includes('not found')) {
                        console.log('Apache.exe kill result:', error2.message);
                    }
                } else {
                    console.log('‚úÖ Additional Apache processes killed:', stdout2.trim());
                }
                
                // ÿ™ŸÜÿ∏ŸäŸÅ ŸÖŸÜÿßŸÅÿ∞ ŸÖÿ¥ÿ∫ŸàŸÑÿ© (ŸÅŸä ÿ≠ÿßŸÑÿ© Ÿàÿ¨ŸàÿØ ÿπŸÖŸÑŸäÿßÿ™ zombie)
                exec('netstat -ano | findstr :80', (error3, stdout3, stderr3) => {
                    if (stdout3) {
                        const lines = stdout3.split('\n');
                        const killPromises = [];
                        
                        lines.forEach(line => {
                            const match = line.match(/\s+(\d+)$/);
                            if (match) {
                                const pid = match[1];
                                const killPromise = new Promise((killResolve) => {
                                    exec(`cmd /c "wmic process where \\"ProcessId=${pid}\\" delete"`, (killError) => {
                                        if (killError) {
                                            console.log(`‚ö†Ô∏è Could not kill PID ${pid}: ${killError.message}`);
                                        } else {
                                            console.log(`‚úÖ Killed process PID ${pid} using port 80`);
                                        }
                                        killResolve();
                                    });
                                });
                                killPromises.push(killPromise);
                            }
                        });
                        
                        if (killPromises.length > 0) {
                            Promise.all(killPromises).then(() => {
                                console.log(`üéØ Finished cleaning ${killPromises.length} port 80 processes`);
                                resolve();
                            });
                        } else {
                            resolve();
                        }
                    } else {
                        resolve();
                    }
                });
            });
        });
    });
}

// ÿØÿßŸÑÿ© ŸÑŸÇÿ™ŸÑ ŸÉŸÑ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿπŸÑŸâ ÿßŸÑŸÖŸÜŸÅÿ∞ 80 ÿ®ŸÇŸàÿ©
async function forceKillPort80Processes() {
    return new Promise((resolve) => {
        console.log('üö® Force killing all processes using port 80...');
        
        // ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖŸÜŸÅÿ∞ 80
        exec('netstat -ano | findstr :80', (error, stdout, stderr) => {
            if (error || !stdout) {
                console.log('‚ÑπÔ∏è No processes found on port 80');
                resolve();
                return;
            }
            
            const lines = stdout.split('\n');
            const pids = new Set(); // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Set ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ŸÉÿ±ÿßÿ±
            
            lines.forEach(line => {
                const match = line.match(/\s+(\d+)$/);
                if (match) {
                    pids.add(match[1]);
                }
            });
            
            if (pids.size === 0) {
                console.log('‚ÑπÔ∏è No PIDs found for port 80');
                resolve();
                return;
            }
            
            console.log(`üî™ Killing ${pids.size} processes: ${Array.from(pids).join(', ')}`);
            
            let killCount = 0;
            const totalPids = pids.size;
            
            if (totalPids === 0) {
                resolve();
                return;
            }
            
            pids.forEach(pid => {
                exec(`cmd /c "wmic process where \\"ProcessId=${pid}\\" delete"`, (killError, killStdout, killStderr) => {
                    killCount++;
                    if (killError) {
                        console.log(`‚ö†Ô∏è Failed to kill PID ${pid}: ${killError.message}`);
                    } else {
                        console.log(`‚úÖ Killed PID ${pid}`);
                    }
                    
                    if (killCount === totalPids) {
                        console.log('üéØ All port 80 processes targeted for termination');
                        resolve();
                    }
                });
            });
        });
    });
}

// ÿ™ÿ¥ÿ∫ŸäŸÑ Apache ŸÖÿ≠ÿ≥ŸÜ
async function startApache() {
  try {
    console.log('üîÑ Stopping any existing Apache processes...');
    showNotification('ÿ™ÿ¥ÿ∫ŸäŸÑ Apache', 'ÿ¨ÿßÿ±Ÿä ÿ•ŸäŸÇÿßŸÅ Apache ÿßŸÑŸÇÿØŸäŸÖ Ÿàÿ®ÿØÿ° ÿ¨ÿØŸäÿØ...');
    
    // ÿ•ŸäŸÇÿßŸÅ ÿ£Ÿä Apache ÿ£ÿÆÿ±Ÿâ ŸÖÿ¥ÿ∫ŸÑÿ© ÿ®ÿ¥ŸÉŸÑ ŸÖÿ≠ÿ≥ŸÜ - 3 ŸÖÿ≠ÿßŸàŸÑÿßÿ™
    for (let attempt = 1; attempt <= 3; attempt++) {
      console.log(`üî™ Kill attempt ${attempt}/3...`);
      await killExistingApacheProcesses();
      
      // ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ®ŸäŸÜ ŸÉŸÑ ŸÖÿ≠ÿßŸàŸÑÿ©
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      const portAvailable = await isPortAvailable(80);
      if (portAvailable) {
        console.log(`‚úÖ Port 80 is now free after attempt ${attempt}`);
        break;
      } else {
        console.log(`‚ö†Ô∏è Port 80 still busy after attempt ${attempt}`);
        if (attempt === 3) {
          // ŸÖÿ≠ÿßŸàŸÑÿ© ÿ£ÿÆŸäÿ±ÿ©: ŸÇÿ™ŸÑ ŸÉŸÑ ÿ¥Ÿäÿ° ÿπŸÑŸâ ÿßŸÑŸÖŸÜŸÅÿ∞ 80
          console.log('üö® Final attempt: killing all processes on port 80...');
          await forceKillPort80Processes();
          await new Promise(resolve => setTimeout(resolve, 3000));
          
          const finalCheck = await isPortAvailable(80);
          if (!finalCheck) {
            showNotification('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ Apache', 'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿ±Ÿäÿ± ÿßŸÑŸÖŸÜŸÅÿ∞ 80. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿÆÿØŸÖÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ.');
            return;
          }
        }
      }
    }
    
    // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖŸÑŸÅ ÿßŸÑÿ™ŸÉŸàŸäŸÜ ÿßŸÑÿµÿ≠Ÿäÿ≠
    const configPath = path.join(baseDir, 'config', 'httpd.conf');
    const apachePath = path.join(baseDir, 'bin', 'apache', 'bin', 'httpd.exe');
    
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ Apache
    if (!fs.existsSync(apachePath)) {
      showNotification('ÿÆÿ∑ÿ£ ŸÅŸä Apache', 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ Apache ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿ≠ÿØÿØ');
      return;
    }
    
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÖŸÑŸÅ ÿßŸÑÿ™ŸÉŸàŸäŸÜ
    if (!fs.existsSync(configPath)) {
      showNotification('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸÉŸàŸäŸÜ Apache', 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖŸÑŸÅ httpd.conf');
      return;
    }
    
    // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿ∑ŸÑŸÇ ŸÑŸÖŸÑŸÅ ÿßŸÑÿ™ŸÉŸàŸäŸÜ
    startService('apache', apachePath, ['-f', configPath]);
    
    showNotification('ÿ™ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ Apache', 'Apache ŸäÿπŸÖŸÑ ÿßŸÑÿ¢ŸÜ ÿπŸÑŸâ http://localhost');
  } catch (error) {
    console.log('Error starting Apache:', error);
    showNotification('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ Apache', error.message);
  }
}

// ÿ™ÿ¥ÿ∫ŸäŸÑ MySQL ŸÖÿ≠ÿ≥ŸÜ
async function startMySQL() {
  try {
    generateMySQLConfig();
    
    const portAvailable = await isPortAvailable(3306);
    if (!portAvailable) {
      showNotification('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ MySQL', 'ÿßŸÑŸÖŸÜŸÅÿ∞ 3306 ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿßŸÑŸÅÿπŸÑ');
      return;
    }
    
    // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ MySQL
    const mysqlPath = path.join(baseDir, 'bin', 'mysql', 'bin', 'mysqld.exe');
    if (!fs.existsSync(mysqlPath)) {
      showNotification('ÿÆÿ∑ÿ£ ŸÅŸä MySQL', 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ MySQL ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿ≠ÿØÿØ');
      return;
    }
    
    // ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¨ŸÑÿØ tmp ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸã
    const tmpDir = path.join(baseDir, 'tmp');
    if (!fs.existsSync(tmpDir)) {
      fs.mkdirSync(tmpDir, { recursive: true });
    }
    
    // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿ∑ŸÑŸÇ ŸÑŸÖŸÑŸÅ ÿßŸÑÿ™ŸÉŸàŸäŸÜ
    const configPath = path.join(baseDir, 'config', 'my.ini');
    
    startService('mysql', mysqlPath, [
      '--defaults-file=' + configPath,
      '--console'
    ]);
    
    showNotification('ÿ™ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ MySQL', 'MySQL ŸäÿπŸÖŸÑ ÿßŸÑÿ¢ŸÜ ÿπŸÑŸâ ÿßŸÑŸÖŸÜŸÅÿ∞ 3306');
    
  } catch (error) {
    console.error('Error starting MySQL:', error);
    showNotification('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ MySQL', error.message);
  }
}

// ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ®ÿ±ÿßŸÖÿ¨ ÿßŸÑÿ≥ÿ±Ÿäÿπÿ©
const quickInstallApps = {
  laravel: {
    name: 'Laravel',
    icon: 'üî∂',
    description: 'ÿ•ÿ∑ÿßÿ± ÿπŸÖŸÑ PHP ÿßŸÑÿ≠ÿØŸäÿ´ ŸàÿßŸÑŸÇŸàŸä',
    requirements: ['php', 'composer', 'node', 'npm'],
    database: true,
    steps: [
      { type: 'command', cmd: 'composer', args: ['create-project', 'laravel/laravel'], description: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¥ÿ±Ÿàÿπ Laravel ÿ¨ÿØŸäÿØ' },
      { type: 'database', description: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™' },
      { type: 'config', description: 'ÿ™ŸÉŸàŸäŸÜ ŸÖŸÑŸÅ .env' },
      { type: 'npm-install', description: 'ÿ™ÿ´ÿ®Ÿäÿ™ dependencies ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ£ŸÖÿßŸÖŸäÿ©' },
      { type: 'app-key', description: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ' },
      { type: 'migrate', description: 'ÿ™ÿ¥ÿ∫ŸäŸÑ migrations ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™' },
      { type: 'npm-build', description: 'ÿ®ŸÜÿßÿ° assets ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ£ŸÖÿßŸÖŸäÿ©' },
      { type: 'domain', description: 'ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä' }
    ]
  },
  wordpress: {
    name: 'WordPress',
    icon: 'üü¶',
    description: 'ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ£ÿ¥Ÿáÿ± ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖ',
    requirements: ['php', 'mysql'],
    database: true,
    downloadUrl: 'https://wordpress.org/latest.zip',
    steps: [
      { type: 'download', description: 'ÿ™ÿ≠ŸÖŸäŸÑ WordPress' },
      { type: 'extract', description: 'ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÖŸÑŸÅÿßÿ™' },
      { type: 'database', description: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™' },
      { type: 'config', description: 'ÿ™ŸÉŸàŸäŸÜ wp-config.php' },
      { type: 'domain', description: 'ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä' }
    ]
  },
  codeigniter: {
    name: 'CodeIgniter',
    icon: 'üî•',
    description: 'ÿ•ÿ∑ÿßÿ± ÿπŸÖŸÑ PHP ÿÆŸÅŸäŸÅ Ÿàÿ≥ÿ±Ÿäÿπ',
    requirements: ['php'],
    database: true,
    downloadUrl: 'https://github.com/codeigniter4/CodeIgniter4/archive/refs/heads/develop.zip',
    steps: [
      { type: 'download', description: 'ÿ™ÿ≠ŸÖŸäŸÑ CodeIgniter' },
      { type: 'extract', description: 'ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÖŸÑŸÅÿßÿ™' },
      { type: 'database', description: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™' },
      { type: 'config', description: 'ÿ™ŸÉŸàŸäŸÜ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™' },
      { type: 'domain', description: 'ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä' }
    ]
  },
  symfony: {
    name: 'Symfony',
    icon: 'üéº',
    description: 'ÿ•ÿ∑ÿßÿ± ÿπŸÖŸÑ PHP ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä ŸàŸÖÿ±ŸÜ',
    requirements: ['php', 'composer'],
    database: true,
    steps: [
      { type: 'command', cmd: 'composer', args: ['create-project', 'symfony/skeleton'], description: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¥ÿ±Ÿàÿπ Symfony' },
      { type: 'database', description: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™' },
      { type: 'config', description: 'ÿ™ŸÉŸàŸäŸÜ .env' },
      { type: 'domain', description: 'ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä' }
    ]
  },
  cakephp: {
    name: 'CakePHP',
    icon: 'üç∞',
    description: 'ÿ•ÿ∑ÿßÿ± ÿπŸÖŸÑ PHP ÿ≥ÿ±Ÿäÿπ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±',
    requirements: ['php', 'composer'],
    database: true,
    steps: [
      { type: 'command', cmd: 'composer', args: ['create-project', 'cakephp/app'], description: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¥ÿ±Ÿàÿπ CakePHP' },
      { type: 'database', description: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™' },
      { type: 'config', description: 'ÿ™ŸÉŸàŸäŸÜ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™' },
      { type: 'domain', description: 'ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä' }
    ]
  },
  express: {
    name: 'Express.js',
    icon: '‚ö°',
    description: 'ÿ•ÿ∑ÿßÿ± ÿπŸÖŸÑ Node.js ÿ≥ÿ±Ÿäÿπ ŸàŸÖÿ±ŸÜ',
    requirements: ['node', 'npm'],
    database: false,
    steps: [
      { type: 'command', cmd: 'npx', args: ['express-generator'], description: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¥ÿ±Ÿàÿπ Express' },
      { type: 'command', cmd: 'npm', args: ['install'], description: 'ÿ™ÿ´ÿ®Ÿäÿ™ Dependencies' },
      { type: 'domain', description: 'ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä' }
    ]
  },
  vue: {
    name: 'Vue.js',
    icon: 'üì±',
    description: 'ÿ•ÿ∑ÿßÿ± ÿπŸÖŸÑ JavaScript ÿ™ÿØÿ±Ÿäÿ¨Ÿä',
    requirements: ['node', 'npm'],
    database: false,
    steps: [
      { type: 'command', cmd: 'npx', args: ['@vue/cli', 'create'], description: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¥ÿ±Ÿàÿπ Vue' },
      { type: 'domain', description: 'ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä' }
    ]
  },
  react: {
    name: 'React',
    icon: '‚öõÔ∏è',
    description: 'ŸÖŸÉÿ™ÿ®ÿ© JavaScript ŸÑÿ®ŸÜÿßÿ° Ÿàÿßÿ¨Ÿáÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ',
    requirements: ['node', 'npm'],
    database: false,
    steps: [
      { type: 'command', cmd: 'npx', args: ['create-react-app'], description: 'ÿ•ŸÜÿ¥ÿßÿ° ÿ™ÿ∑ÿ®ŸäŸÇ React' },
      { type: 'domain', description: 'ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä' }
    ]
  }
};

// ÿØÿßŸÑÿ© ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ≥ÿ±Ÿäÿπ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
async function quickInstall(appType) {
  console.log('Starting quick install for:', appType);
  
  const app = quickInstallApps[appType];
  if (!app) {
    console.error('Unsupported app type:', appType);
    dialog.showErrorBox('ÿÆÿ∑ÿ£', 'ŸÜŸàÿπ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿ∫Ÿäÿ± ŸÖÿØÿπŸàŸÖ');
    return;
  }

  console.log('App found:', app.name);

  // ÿ∑ŸÑÿ® ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸÖŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
  const result = await dialog.showMessageBox(null, {
    type: 'question',
    buttons: ['ŸÖÿ™ÿßÿ®ÿπÿ©', 'ÿ•ŸÑÿ∫ÿßÿ°'],
    title: `ÿ™ÿ´ÿ®Ÿäÿ™ ${app.name}`,
    message: `ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ´ÿ®Ÿäÿ™ ${app.name}ÿü`,
    detail: `${app.description}\n\nÿ≥Ÿäÿ™ŸÖ:\n‚Ä¢ ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¥ÿ±Ÿàÿπ ÿ¨ÿØŸäÿØ\n‚Ä¢ ${app.database ? 'ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™\n‚Ä¢ ' : ''}ÿ•ÿπÿØÿßÿØ ÿØŸàŸÖŸäŸÜ .test\n‚Ä¢ ÿ™ŸÉŸàŸäŸÜ ÿßŸÑÿ®Ÿäÿ¶ÿ©`
  });

  console.log('Dialog result:', result.response);
  if (result.response !== 0) {
    console.log('Installation cancelled by user');
    return;
  }

  // ÿ∑ŸÑÿ® ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
  try {
    const projectName = await getProjectName(app.name);
    if (!projectName) {
      console.log('Project name input cancelled');
      return;
    }
    
    console.log('Project name entered:', projectName);
    
    // ÿ®ÿØÿ° ÿπŸÖŸÑŸäÿ© ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™
    await performQuickInstall(appType, projectName);
    
  } catch (error) {
    console.error('Error getting project name:', error);
    dialog.showErrorBox('ÿÆÿ∑ÿ£', 'ŸÅÿ¥ŸÑ ŸÅŸä ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ');
    return;
  }


}

// ÿ∑ŸÑÿ® ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸÖŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
async function getProjectName(appName) {
  return new Promise((resolve) => {
    // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ dialog ÿ®ÿ≥Ÿäÿ∑ ŸàŸÖŸàÿ´ŸàŸÇ
    const { dialog } = require('electron');
    
    // ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© input ÿ®ÿ≥Ÿäÿ∑ÿ©
    const inputWindow = new BrowserWindow({
      width: 400,
      height: 400,
      resizable: false,
      maximizable: false,
      minimizable: false,
      alwaysOnTop: true,
      center: true,
      title: `ÿßÿ≥ŸÖ ŸÖÿ¥ÿ±Ÿàÿπ ${appName}`,
      skipTaskbar: true,
      show: false,
      autoHideMenuBar: true,
      webPreferences: {
        nodeIntegration: true,
        contextIsolation: false
      }
    });

    const inputHtml = `
<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            padding: 20px;
        }
        
        .container {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 350px;
        }
        
        h2 {
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-family: 'Cairo', sans-serif;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102,126,234,0.3);
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .hint {
            color: #666;
            font-size: 12px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</h2>
        <div class="hint">ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿßŸÑÿ¨ÿØŸäÿØ (ÿ®ÿØŸàŸÜ ŸÖÿ≥ÿßŸÅÿßÿ™)</div>
        <input type="text" id="projectName" placeholder="my-project" value="">
        <div class="buttons">
            <button class="btn-primary" onclick="confirmProject()">ÿ•ŸÜÿ¥ÿßÿ°</button>
            <button class="btn-secondary" onclick="cancelProject()">ÿ•ŸÑÿ∫ÿßÿ°</button>
        </div>
    </div>
    
    <script>
        const { ipcRenderer } = require('electron');
        let resolved = false;
        
        function confirmProject() {
            if (resolved) return;
            const name = document.getElementById('projectName').value.trim();
            if (name && name.length > 0) {
                resolved = true;
                ipcRenderer.send('project-name-result', name);
                window.close();
            } else {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ');
            }
        }
        
        function cancelProject() {
            if (resolved) return;
            resolved = true;
            ipcRenderer.send('project-name-result', null);
            window.close();
        }
        
        // ÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ input ÿπŸÜÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('projectName').focus();
            document.getElementById('projectName').select();
        });
        
        // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠
        document.getElementById('projectName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                confirmProject();
            }
        });
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                cancelProject();
            }
        });
    </script>
</body>
</html>`;

    inputWindow.loadURL(`data:text/html;charset=utf-8,${encodeURIComponent(inputHtml)}`);
    
    inputWindow.once('ready-to-show', () => {
      inputWindow.show();
    });

    // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©
    const { ipcMain } = require('electron');
    let isHandled = false;
    
    const handleResult = (event, result) => {
      if (isHandled) return;
      isHandled = true;
      
      inputWindow.close();
      ipcMain.removeListener('project-name-result', handleResult);
      resolve(result);
    };
    
    ipcMain.once('project-name-result', handleResult);
    
    inputWindow.on('closed', () => {
      if (!isHandled) {
        isHandled = true;
        ipcMain.removeListener('project-name-result', handleResult);
        resolve(null);
      }
    });
  });
}

// ŸÅÿ≠ÿµ ŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™
async function checkRequirements(requirements) {
  console.log('Checking requirements:', requirements);
  
  const results = {
    allMet: true,
    missing: []
  };

  for (const req of requirements) {
    let available = false;
    
    try {
      console.log(`Checking ${req}...`);
      
      switch (req) {
        case 'php':
          // ŸÅÿ≠ÿµ Ÿàÿ¨ŸàÿØ PHP
          const phpPath = path.join(baseDir, 'bin', 'php');
          available = fs.existsSync(phpPath);
          console.log(`PHP path: ${phpPath}, exists: ${available}`);
          break;
          
        case 'composer':
          // ŸÅÿ≠ÿµ Ÿàÿ¨ŸàÿØ Composer (ÿ™ÿÆÿ∑Ÿä ÿßŸÑŸÅÿ≠ÿµ ŸÑŸÑÿ™ÿ®ÿ≥Ÿäÿ∑)
          available = true; // ÿ≥ŸÜÿ™ÿπÿßŸÖŸÑ ŸÖÿπ Ÿáÿ∞ÿß ŸÑÿßÿ≠ŸÇÿßŸã
          console.log('Composer: available (temporary)');
          break;
          
        case 'mysql':
          // ŸÅÿ≠ÿµ Ÿàÿ¨ŸàÿØ MySQL server
          const mysqlServerPath = path.join(baseDir, 'bin', 'mysql', 'bin', 'mysqld.exe');
          const mysqlClientPath = path.join(baseDir, 'bin', 'mysql', 'bin', 'mysql.exe');
          
          // ŸÜÿ≠ÿ™ÿßÿ¨ MySQL server ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ
          available = fs.existsSync(mysqlServerPath);
          console.log(`MySQL server path: ${mysqlServerPath}, exists: ${available}`);
          console.log(`MySQL client path: ${mysqlClientPath}, exists: ${fs.existsSync(mysqlClientPath)}`);
          break;
          
        case 'node':
          // ŸÅÿ≠ÿµ Ÿàÿ¨ŸàÿØ Node.js (ÿ™ÿÆÿ∑Ÿä ÿßŸÑŸÅÿ≠ÿµ ŸÑŸÑÿ™ÿ®ÿ≥Ÿäÿ∑)
          available = true; // ÿ≥ŸÜÿ™ÿπÿßŸÖŸÑ ŸÖÿπ Ÿáÿ∞ÿß ŸÑÿßÿ≠ŸÇÿßŸã
          console.log('Node.js: available (temporary)');
          break;
          
        case 'npm':
          // ŸÅÿ≠ÿµ Ÿàÿ¨ŸàÿØ npm (ÿ™ÿÆÿ∑Ÿä ÿßŸÑŸÅÿ≠ÿµ ŸÑŸÑÿ™ÿ®ÿ≥Ÿäÿ∑)
          available = true; // ÿ≥ŸÜÿ™ÿπÿßŸÖŸÑ ŸÖÿπ Ÿáÿ∞ÿß ŸÑÿßÿ≠ŸÇÿßŸã
          console.log('npm: available (temporary)');
          break;
          
        default:
          available = true; // ŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅÿ© ÿ™ÿπÿ™ÿ®ÿ± ŸÖÿ™ŸàŸÅÿ±ÿ©
          break;
      }
    } catch (error) {
      console.error(`Error checking ${req}:`, error);
      available = false;
    }
    
    console.log(`${req}: ${available ? 'available' : 'not available'}`);
    
    if (!available) {
      results.allMet = false;
      results.missing.push(req);
    }
  }

  console.log('Requirements check result:', results);
  return results;
}

// ÿØÿßŸÑÿ© ŸÑÿ•ÿ∂ÿßŸÅÿ© virtual host ŸÖÿπ ÿ•ÿπÿØÿßÿØ ŸÉÿßŸÖŸÑ ÿ™ŸÑŸÇÿßÿ¶Ÿä
async function addVirtualHost(projectName, appType = 'laravel') {
    try {
        console.log(`üöÄ Setting up ${appType} site: ${projectName}.test`);
        
        // ÿ™ÿ≠ÿØŸäÿØ ŸÖÿ¨ŸÑÿØ DocumentRoot ÿ≠ÿ≥ÿ® ŸÜŸàÿπ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        let documentRoot = `C:/MyDevBox/www/${projectName}`;
        let directoryPath = documentRoot;
        
        // Laravel ŸàFrameworks ÿ£ÿÆÿ±Ÿâ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖÿ¨ŸÑÿØ public
        if (['laravel', 'symfony', 'cakephp'].includes(appType)) {
            documentRoot += '/public';
            directoryPath += '/public';
        }
        
        const vhostContent = `
<VirtualHost *:80>
    DocumentRoot "${documentRoot}"
    ServerName ${projectName}.test
    ServerAlias www.${projectName}.test
    ErrorLog "logs/${projectName}_error.log"
    CustomLog "logs/${projectName}_access.log" common
    <Directory "${directoryPath}">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
`;

        // 1. ÿ•ŸÜÿ¥ÿßÿ° virtual host file
        const vhostsDir = path.join(__dirname, 'config', 'vhosts');
        if (!fs.existsSync(vhostsDir)) {
            fs.mkdirSync(vhostsDir, { recursive: true });
        }
        
        const vhostPath = path.join(vhostsDir, `${projectName}.conf`);
        fs.writeFileSync(vhostPath, vhostContent, 'utf8');
        console.log(`‚úÖ Virtual host file created: ${projectName}.conf`);
        
        // 2. ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜÿ∑ÿßŸÇ ÿ•ŸÑŸâ ŸÖŸÑŸÅ hosts ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
        addToHostsFile(projectName);
        
        // 3. ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ•ÿ∞ÿß ŸÉÿßŸÜ Laravel
        if (appType === 'laravel') {
            createMySQLDatabase(projectName);
        }
        
        // 4. ÿ•ÿπÿØÿßÿØ Laravel ÿ•ÿ∂ÿßŸÅŸä ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÜŸàÿπ Laravel
        if (appType === 'laravel') {
            setupLaravelEnvironment(projectName);
        }
        
        // 5. ÿ™ŸÜÿ∏ŸäŸÅ ÿ£Ÿä Include statements ÿÆÿßÿ∑ÿ¶ÿ©
        cleanupHttpdConf(projectName);
        
        // 6. ÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ Apache ŸÑÿ™ÿ≠ŸÖŸäŸÑ Virtual Host ÿßŸÑÿ¨ÿØŸäÿØ
        console.log(`üîÑ Restarting Apache to load new virtual host...`);
        await restartApacheForNewSite(projectName);
        
        console.log(`üéâ ${projectName}.test is ready! Visit: http://${projectName}.test`);
        return true;
    } catch (error) {
        console.error('Error adding virtual host:', error);
        return false;
    }
}

// ÿØÿßŸÑÿ© ŸÑÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜÿ∑ÿßŸÇ ÿ•ŸÑŸâ ŸÖŸÑŸÅ hosts ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
function addToHostsFile(projectName) {
    try {
        const domain = `${projectName}.test`;
        const hostsPath = 'C:\\Windows\\System32\\drivers\\etc\\hosts';
        
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÜÿ∑ÿßŸÇ ŸÖÿ≥ÿ®ŸÇÿßŸã
        if (fs.existsSync(hostsPath)) {
            const hostsContent = fs.readFileSync(hostsPath, 'utf8');
            if (hostsContent.includes(domain)) {
                console.log(`‚ÑπÔ∏è ${domain} already exists in hosts file`);
                return;
            }
        }
        
        // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜÿ∑ÿßŸÇ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ PowerShell ŸÖÿπ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ Admin
        const { spawn } = require('child_process');
        const addHostsCmd = spawn('powershell', [
            '-Command',
            `Start-Process powershell -Verb RunAs -ArgumentList "-Command \\"echo '127.0.0.1 ${domain}' >> C:\\Windows\\System32\\drivers\\etc\\hosts; echo 'Added ${domain} to hosts file'\\"" -WindowStyle Hidden -Wait`
        ], { stdio: 'ignore' });
        
        addHostsCmd.on('close', (code) => {
            if (code === 0) {
                console.log(`‚úÖ Added ${domain} to hosts file`);
            } else {
                console.log(`‚ö†Ô∏è Could not add ${domain} to hosts file automatically. Please add manually:
    127.0.0.1 ${domain}`);
            }
        });
        
    } catch (error) {
        console.error('Error adding to hosts file:', error);
        console.log(`‚ö†Ô∏è Please add manually to hosts file: 127.0.0.1 ${projectName}.test`);
    }
}

// ÿØÿßŸÑÿ© ŸÑÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ MySQL
function createMySQLDatabase(projectName) {
    try {
        const dbName = `${projectName}_db`;
        console.log(`üóÑÔ∏è Creating MySQL database: ${dbName}...`);
        
        // ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ SQL ŸÖÿ§ŸÇÿ™
        const sqlContent = `CREATE DATABASE IF NOT EXISTS \`${dbName}\` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;`;
        const tempSqlPath = path.join(__dirname, 'temp_create_db.sql');
        fs.writeFileSync(tempSqlPath, sqlContent, 'utf8');
        
        // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿ£ŸÖÿ± MySQL
        const { spawn } = require('child_process');
        const mysqlCmd = spawn('mysql', [
            '-u', 'root',
            '-e', `source ${tempSqlPath}`
        ], { stdio: 'pipe' });
        
        mysqlCmd.on('close', (code) => {
            // ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™
            if (fs.existsSync(tempSqlPath)) {
                fs.unlinkSync(tempSqlPath);
            }
            
            if (code === 0) {
                console.log(`‚úÖ Database ${dbName} created successfully`);
            } else {
                console.log(`‚ö†Ô∏è Could not create database ${dbName} automatically. Please create manually:
    CREATE DATABASE \`${dbName}\` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;`);
            }
        });
        
        mysqlCmd.on('error', (error) => {
            // ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™ ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£
            if (fs.existsSync(tempSqlPath)) {
                fs.unlinkSync(tempSqlPath);
            }
            console.log(`‚ö†Ô∏è MySQL not available or error creating database: ${error.message}`);
            console.log(`Please create database manually: CREATE DATABASE \`${dbName}\`;`);
        });
        
    } catch (error) {
        console.error('Error creating MySQL database:', error);
    }
}

// ÿØÿßŸÑÿ© ŸÑÿ•ÿπÿØÿßÿØ ÿ®Ÿäÿ¶ÿ© Laravel
function setupLaravelEnvironment(projectName) {
    try {
        const projectPath = path.join(__dirname, 'www', projectName);
        
        console.log(`üîß Setting up Laravel environment for ${projectName}...`);
        
        // 1. ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ .env ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸã
        const envPath = path.join(projectPath, '.env');
        const envExamplePath = path.join(projectPath, '.env.example');
        
        if (!fs.existsSync(envPath)) {
            if (fs.existsSync(envExamplePath)) {
                // ŸÜÿ≥ÿÆ ŸÖŸÜ .env.example
                const envContent = fs.readFileSync(envExamplePath, 'utf8');
                let updatedEnv = envContent
                    .replace('APP_URL=http://localhost', `APP_URL=http://${projectName}.test`)
                    .replace('DB_DATABASE=laravel', `DB_DATABASE=${projectName}_db`);
                
                fs.writeFileSync(envPath, updatedEnv, 'utf8');
                console.log(`‚úÖ Created .env file from .env.example`);
            } else {
                // ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ .env ÿ£ÿ≥ÿßÿ≥Ÿä
                const basicEnv = createBasicLaravelEnv(projectName);
                fs.writeFileSync(envPath, basicEnv, 'utf8');
                console.log(`‚úÖ Created basic .env file`);
            }
        } else {
            console.log(`‚ÑπÔ∏è .env file already exists`);
        }
        
        // 2. ÿ™ÿ¥ÿ∫ŸäŸÑ ÿ£ŸàÿßŸÖÿ± Laravel ÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        runLaravelCommands(projectPath, projectName);
        
    } catch (error) {
        console.error('Error setting up Laravel environment:', error);
    }
}

// ÿØÿßŸÑÿ© ŸÑÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ .env ÿ£ÿ≥ÿßÿ≥Ÿä
function createBasicLaravelEnv(projectName) {
    return `APP_NAME=Laravel
APP_ENV=local
APP_KEY=
APP_DEBUG=true
APP_TIMEZONE=UTC
APP_URL=http://${projectName}.test

APP_LOCALE=en
APP_FALLBACK_LOCALE=en
APP_FAKER_LOCALE=en_US

BCRYPT_ROUNDS=12

LOG_CHANNEL=stack
LOG_STACK=single
LOG_LEVEL=debug

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=${projectName}_db
DB_USERNAME=root
DB_PASSWORD=

SESSION_DRIVER=database
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_PATH=/
SESSION_DOMAIN=null

BROADCAST_CONNECTION=log
FILESYSTEM_DISK=local
QUEUE_CONNECTION=database

CACHE_STORE=database
CACHE_PREFIX=

MAIL_MAILER=log
MAIL_HOST=127.0.0.1
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="\${APP_NAME}"

VITE_APP_NAME="\${APP_NAME}"`;
}

// ÿØÿßŸÑÿ© ŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿ£ŸàÿßŸÖÿ± Laravel ÿ£ÿ≥ÿßÿ≥Ÿäÿ©
function runLaravelCommands(projectPath, projectName) {
    try {
        console.log(`‚öôÔ∏è Running Laravel setup commands...`);
        
        // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ŸàÿßŸÖÿ± ÿ®ÿ¥ŸÉŸÑ ŸÖÿ™ÿ™ÿßŸÑŸä
        const commands = [
            { cmd: 'php', args: ['artisan', 'key:generate'], desc: 'Generating application key' },
            { cmd: 'php', args: ['artisan', 'storage:link'], desc: 'Creating storage link' },
            { cmd: 'php', args: ['artisan', 'migrate', '--force'], desc: 'Running database migrations' }
        ];
        
        let commandIndex = 0;
        
        function runNextCommand() {
            if (commandIndex >= commands.length) {
                console.log(`‚úÖ Laravel setup completed for ${projectName}`);
                return;
            }
            
            const command = commands[commandIndex];
            console.log(`üìù ${command.desc}...`);
            
            const { spawn } = require('child_process');
            const proc = spawn(command.cmd, command.args, {
                cwd: projectPath,
                stdio: 'pipe'
            });
            
            proc.on('close', (code) => {
                if (code === 0) {
                    console.log(`‚úÖ ${command.desc} completed`);
                } else {
                    console.log(`‚ö†Ô∏è ${command.desc} failed (code: ${code})`);
                }
                commandIndex++;
                setTimeout(runNextCommand, 500); // ÿ™ÿ£ÿÆŸäÿ± ŸÇÿµŸäÿ± ÿ®ŸäŸÜ ÿßŸÑÿ£ŸàÿßŸÖÿ±
            });
            
            proc.on('error', (error) => {
                console.log(`‚ö†Ô∏è ${command.desc} error: ${error.message}`);
                commandIndex++;
                setTimeout(runNextCommand, 500);
            });
        }
        
        runNextCommand();
        
    } catch (error) {
        console.error('Error running Laravel commands:', error);
    }
}

// ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¥ÿ±Ÿàÿπ Laravel ÿ¨ÿØŸäÿØ ÿ®ÿßŸÑŸÉÿßŸÖŸÑ
async function createNewLaravelProject(projectName) {
    try {
        console.log(`üöÄ Creating new Laravel project: ${projectName}`);
        
        const projectPath = path.join(__dirname, 'www', projectName);
        
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸÖÿ≥ÿ®ŸÇÿßŸã
        if (fs.existsSync(projectPath)) {
            console.log(`‚ö†Ô∏è Project ${projectName} already exists`);
            // ÿ•ÿπÿØÿßÿØ Virtual Host ŸÑŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿßŸÑŸÖŸàÿ¨ŸàÿØ
            await addVirtualHost(projectName, 'laravel');
            return;
        }
        
        console.log(`üì¶ Installing Laravel via Composer...`);
        
        // ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¥ÿ±Ÿàÿπ Laravel ÿ¨ÿØŸäÿØ
        const { spawn } = require('child_process');
        const composerCmd = spawn('composer', [
            'create-project',
            'laravel/laravel',
            projectName,
            '--prefer-dist'
        ], {
            cwd: path.join(__dirname, 'www'),
            stdio: 'pipe'
        });
        
        composerCmd.stdout.on('data', (data) => {
            console.log(`Composer: ${data.toString().trim()}`);
        });
        
        composerCmd.stderr.on('data', (data) => {
            console.error(`Composer Error: ${data.toString().trim()}`);
        });
        
        composerCmd.on('close', (code) => {
            if (code === 0) {
                console.log(`‚úÖ Laravel project created successfully`);
                // ÿ•ÿπÿØÿßÿØ Virtual Host Ÿà ŸÉŸÑ ÿ¥Ÿäÿ° ÿ¢ÿÆÿ±
                setTimeout(async () => {
                    await addVirtualHost(projectName, 'laravel');
                }, 1000);
            } else {
                console.error(`‚ùå Failed to create Laravel project (exit code: ${code})`);
                console.log(`Please create manually: composer create-project laravel/laravel ${projectName}`);
            }
        });
        
        composerCmd.on('error', (error) => {
            console.error('Error running composer:', error);
            console.log(`‚ö†Ô∏è Composer not available. Please install Laravel manually:
    cd C:/MyDevBox/www
    composer create-project laravel/laravel ${projectName}
    
Then use MyDevBox to add virtual host.`);
        });
        
    } catch (error) {
        console.error('Error creating Laravel project:', error);
    }
}

// ÿØÿßŸÑÿ© ŸÑÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ÿßÿ±Ÿäÿπ Laravel ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ© (ÿ™ÿ¥ÿ∫ŸäŸÑ migrate)
function fixExistingLaravelProject(projectName) {
    try {
        const projectPath = path.join(__dirname, 'www', projectName);
        
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
        if (!fs.existsSync(projectPath)) {
            console.log(`‚ùå Project ${projectName} not found`);
            return;
        }
        
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÖŸÑŸÅ artisan (Laravel project)
        const artisanPath = path.join(projectPath, 'artisan');
        if (!fs.existsSync(artisanPath)) {
            console.log(`‚ùå ${projectName} is not a Laravel project`);
            return;
        }
        
        console.log(`üîß Fixing Laravel project: ${projectName}...`);
        
        // ÿ™ÿ¥ÿ∫ŸäŸÑ migrate ŸÑŸÑŸÖÿ¥ÿ±Ÿàÿπ
        const { spawn } = require('child_process');
        const migrateCmd = spawn('php', ['artisan', 'migrate', '--force'], {
            cwd: projectPath,
            stdio: 'pipe'
        });
        
        migrateCmd.stdout.on('data', (data) => {
            console.log(`Migration: ${data.toString().trim()}`);
        });
        
        migrateCmd.stderr.on('data', (data) => {
            console.error(`Migration Error: ${data.toString().trim()}`);
        });
        
        migrateCmd.on('close', (code) => {
            if (code === 0) {
                console.log(`‚úÖ Database migrations completed for ${projectName}`);
                console.log(`üéâ ${projectName}.test should now work properly!`);
            } else {
                console.log(`‚ö†Ô∏è Migration failed for ${projectName} (code: ${code})`);
                console.log(`Please run manually: cd www/${projectName} && php artisan migrate`);
            }
        });
        
        migrateCmd.on('error', (error) => {
            console.error('Error running migrate:', error);
            console.log(`Please run manually: cd www/${projectName} && php artisan migrate`);
        });
        
    } catch (error) {
        console.error('Error fixing Laravel project:', error);
    }
}

// ÿØÿßŸÑÿ© ŸÑÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ Apache ÿ®ÿπÿØ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ ÿ¨ÿØŸäÿØ
async function restartApacheForNewSite(projectName) {
    try {
        console.log(`üîÑ Reloading Apache configuration for ${projectName}...`);
        
        // ŸÖÿ≠ÿßŸàŸÑÿ© reload ÿ£ŸàŸÑÿßŸã (ÿ£ÿ≥ÿ±ÿπ)
        const reloadSuccess = await reloadApacheConfig();
        if (reloadSuccess) {
            console.log(`‚úÖ ${projectName}.test should now work (configuration reloaded)`);
            return true;
        }
        
        // ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑ reloadÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ restart ŸÉÿßŸÖŸÑ
        console.log('üîÑ Reload failed, performing full restart...');
        console.log('üõë Stopping Apache...');
        await killExistingApacheProcesses();
        
        // ÿßŸÜÿ™ÿ∏ÿßÿ± ŸÇÿµŸäÿ± ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿ•ŸäŸÇÿßŸÅ
        await new Promise(resolve => setTimeout(resolve, 3000));
        
        // ÿ®ÿØÿ° Apache ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ
        console.log('üöÄ Starting Apache with new configuration...');
        
        const configPath = path.join(__dirname, 'config', 'httpd.conf');
        const apachePath = path.join(__dirname, 'bin', 'apache', 'bin', 'httpd.exe');
        
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖŸÑŸÅÿßÿ™
        if (!fs.existsSync(apachePath) || !fs.existsSync(configPath)) {
            console.log('‚ö†Ô∏è Apache files not found, skipping restart');
            return false;
        }
        
        // ÿ™ÿ¥ÿ∫ŸäŸÑ Apache ŸÅŸä ÿßŸÑÿÆŸÑŸÅŸäÿ©
        const { spawn } = require('child_process');
        const apacheProcess = spawn(apachePath, ['-f', configPath], {
            cwd: path.join(__dirname, 'bin', 'apache'),
            stdio: 'ignore', // ÿ™ÿ¨ÿßŸáŸÑ ÿßŸÑŸÄ output ŸÑÿ™ÿ¨ŸÜÿ® blocking
            detached: true // ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÖŸÜŸÅÿµŸÑ
        });
        
        // ÿπÿØŸÖ ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑÿπŸÖŸÑŸäÿ©
        apacheProcess.unref();
        
        // ÿßŸÜÿ™ÿ∏ÿßÿ± ŸÇÿµŸäÿ± ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿ®ÿØÿ°
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ£ŸÜ Apache ŸäÿπŸÖŸÑ
        return new Promise((resolve) => {
            exec('netstat -an | findstr ":80"', (error, stdout) => {
                if (stdout && stdout.includes(':80')) {
                    console.log(`‚úÖ Apache restarted successfully! ${projectName}.test should now work`);
                    resolve(true);
                } else {
                    console.log(`‚ö†Ô∏è Apache restart may have failed. Please check manually`);
                    resolve(false);
                }
            });
        });
        
    } catch (error) {
        console.error('Error restarting Apache:', error);
        return false;
    }
}

// ÿØÿßŸÑÿ© ŸÑÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ Apache ÿ®ÿØŸàŸÜ ÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÉÿßŸÖŸÑ (ÿ£ÿ≥ÿ±ÿπ)
async function reloadApacheConfig() {
    try {
        console.log('üîÑ Reloading Apache configuration...');
        
        const apachePath = path.join(__dirname, 'bin', 'apache', 'bin', 'httpd.exe');
        const configPath = path.join(__dirname, 'config', 'httpd.conf');
        
        if (!fs.existsSync(apachePath)) {
            console.log('‚ö†Ô∏è Apache not found, using restart method');
            return false;
        }
        
        // ŸÖÿ≠ÿßŸàŸÑÿ© graceful restart ÿ£ŸàŸÑÿßŸã
        const { spawn } = require('child_process');
        const reloadProcess = spawn(apachePath, ['-f', configPath, '-k', 'graceful'], {
            stdio: 'pipe'
        });
        
        return new Promise((resolve) => {
            reloadProcess.on('close', (code) => {
                if (code === 0) {
                    console.log('‚úÖ Apache configuration reloaded successfully');
                    resolve(true);
                } else {
                    console.log('‚ö†Ô∏è Graceful reload failed, using restart method');
                    resolve(false);
                }
            });
            
            reloadProcess.on('error', () => {
                console.log('‚ö†Ô∏è Reload command failed, using restart method');
                resolve(false);
            });
            
            // timeout ÿ®ÿπÿØ 5 ÿ´ŸàÿßŸÜ
            setTimeout(() => {
                reloadProcess.kill();
                resolve(false);
            }, 5000);
        });
        
    } catch (error) {
        console.error('Error reloading Apache:', error);
        return false;
    }
}

// ÿØÿßŸÑÿ© ŸÑÿ™ŸÜÿ∏ŸäŸÅ ŸÖŸÑŸÅ httpd.conf ŸÖŸÜ Include statements ÿÆÿßÿ∑ÿ¶ÿ©
function cleanupHttpdConf(projectName = null) {
    try {
        const httpdConfPath = path.join(__dirname, 'config', 'httpd.conf');
        if (!fs.existsSync(httpdConfPath)) {
            return;
        }
        
        let content = fs.readFileSync(httpdConfPath, 'utf8');
        
        // ŸÜÿ≥ÿÆÿ© ŸÖŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ£ÿµŸÑŸä ŸÑŸÑŸÖŸÇÿßÿ±ŸÜÿ©
        const originalContent = content;
        
        if (projectName) {
            // ÿ•ÿ≤ÿßŸÑÿ© Include statements ŸÑŸÖÿ¥ÿ±Ÿàÿπ ŸÖÿ≠ÿØÿØ
            const includePattern = new RegExp(`\\n\\s*Include\\s+"[^"]*config/vhosts/${projectName}\\.conf"`, 'g');
            content = content.replace(includePattern, '');
            
            const relativePattern = new RegExp(`\\n\\s*Include\\s+"\\.\\./\\.\\./\\.\\./config/vhosts/${projectName}\\.conf"`, 'g');
            content = content.replace(relativePattern, '');
        } else {
            // ÿ™ŸÜÿ∏ŸäŸÅ ÿ¥ÿßŸÖŸÑ ŸàŸÇŸàŸä - ÿ•ÿ≤ÿßŸÑÿ© ÿ¨ŸÖŸäÿπ Include statements ÿßŸÑÿÆÿßÿ∑ÿ¶ÿ© ÿ®ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ¥ŸÉÿßŸÑ ÿßŸÑŸÖŸÖŸÉŸÜÿ©
            content = content.replace(/\n\s*Include\s+"\.\.\/\.\.\/\.\.\/config\/vhosts\/[^"]+\.conf"/g, '');
            content = content.replace(/\n\s*Include\s+"[^"]*config\/vhosts\/[^"]+\.conf"/g, '');
            content = content.replace(/\n\s*Include\s+"[^"]*vhosts\/[^"]+\.conf"/g, '');
            content = content.replace(/\n\s*Include\s+"\.\.\/[^"]*vhosts[^"]*\.conf"/g, '');
            content = content.replace(/\n\s*Include\s+"[^"]*\.\.\/[^"]*\.conf"/g, '');
            // ÿ•ÿ≤ÿßŸÑÿ© ÿ£Ÿä Include ŸÖÿπ ŸÖÿ≥ÿßÿ± ŸÜÿ≥ÿ®Ÿä
            content = content.replace(/\n\s*Include\s+"\.\.\/[^"]*"/g, '');
        }
        
        // ÿ≠ŸÖÿßŸäÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©: ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ IncludeOptional ÿßŸÑÿµÿ≠Ÿäÿ≠ ŸÅŸÇÿ∑
        if (!content.includes('IncludeOptional "C:/MyDevBox/config/vhosts/*.conf"')) {
            // ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸãÿå ÿ£ÿ∂ŸÅŸá ŸÇÿ®ŸÑ ŸÜŸáÿßŸäÿ© ÿßŸÑŸÖŸÑŸÅ
            const lines = content.split('\n');
            const insertIndex = lines.findIndex(line => line.includes('ServerTokens Prod')) || lines.length - 1;
            lines.splice(insertIndex, 0, '', '# Include Virtual Hosts', 'IncludeOptional "C:/MyDevBox/config/vhosts/*.conf"', '');
            content = lines.join('\n');
        }
        
        // ŸÅŸÇÿ∑ ÿßŸÑŸÉÿ™ÿßÿ®ÿ© ÿ•ÿ∞ÿß ÿ™ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
        if (content !== originalContent) {
            // ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖÿß ÿ™ŸÖ ÿ≠ÿ∞ŸÅŸá
            const deletedLines = originalContent.split('\n').filter(line => 
                line.includes('Include') && 
                (line.includes('../../../config/vhosts/') || line.includes('config/vhosts/'))
            );
            
            if (deletedLines.length > 0) {
                console.log(`üßπ CLEANUP: Found and removed ${deletedLines.length} bad Include statements:`);
                deletedLines.forEach(line => console.log(`   ‚ùå ${line.trim()}`));
                
                // ÿ™ÿ≥ÿ¨ŸäŸÑ stack trace ŸÑŸÖÿπÿ±ŸÅÿ© ŸÖŸÜ ÿßÿ≥ÿ™ÿØÿπŸâ Ÿáÿ∞Ÿá ÿßŸÑÿØÿßŸÑÿ©
                console.log('üìç Cleanup called from:');
                const stack = new Error().stack.split('\n').slice(1, 5);
                stack.forEach(line => console.log(`   ${line.trim()}`));
            }
            
            fs.writeFileSync(httpdConfPath, content, 'utf8');
            console.log(`‚úÖ httpd.conf cleaned successfully`);
        }
        
    } catch (error) {
        console.error('Error cleaning up httpd.conf:', error);
    }
}

// ÿØÿßŸÑÿ© ŸÑÿ•ÿπÿØÿßÿØ ŸÖÿ±ÿßŸÇÿ® ŸÖŸÑŸÅ httpd.conf
function setupHttpdConfWatcher() {
    try {
        const httpdConfPath = path.join(__dirname, 'config', 'httpd.conf');
        if (!fs.existsSync(httpdConfPath)) {
            return;
        }
        
        // ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ£ÿµŸÑŸä ŸÑŸÑŸÖŸÇÿßÿ±ŸÜÿ©
        let lastKnownContent = fs.readFileSync(httpdConfPath, 'utf8');
        
        // ŸÖÿ±ÿßŸÇÿ®ÿ© ÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ŸÖŸÑŸÅ httpd.conf ŸÖÿπ ŸÅÿ™ÿ±ÿ© ÿ£ŸÇÿµÿ±
        fs.watchFile(httpdConfPath, { interval: 500 }, (curr, prev) => {
            if (curr.mtime !== prev.mtime) {
                console.log('üîç httpd.conf modified - analyzing changes...');
                
                const currentContent = fs.readFileSync(httpdConfPath, 'utf8');
                const currentLines = currentContent.split('\n');
                const lastLines = lastKnownContent.split('\n');
                
                // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ£ÿ≥ÿ∑ÿ± ÿßŸÑŸÖŸèÿ∂ÿßŸÅÿ©
                const addedLines = currentLines.filter((line, index) => 
                    line.includes('Include') && 
                    (line.includes('../../../config/vhosts/') || line.includes('config/vhosts/')) &&
                    !lastLines[index]?.includes(line)
                );
                
                if (addedLines.length > 0) {
                    console.log(`üö® DETECTED: Someone added ${addedLines.length} bad Include statements:`);
                    addedLines.forEach(line => console.log(`   ‚ûï ${line.trim()}`));
                    
                    // ÿ™ÿ≥ÿ¨ŸäŸÑ timestamp
                    console.log(`   üïê Time: ${new Date().toLocaleString()}`);
                }
                
                lastKnownContent = currentContent;
                
                // ÿ™ÿ£ÿÆŸäÿ± ŸÇÿµŸäÿ± ÿ¨ÿØÿßŸã ŸÇÿ®ŸÑ ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ
                setTimeout(() => {
                    cleanupHttpdConf();
                }, 200);
            }
        });
        
        // ŸÖÿ±ÿßŸÇÿ®ÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ fs.watch ŸÑŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© ÿßŸÑŸÅŸàÿ±Ÿäÿ©
        fs.watch(httpdConfPath, (eventType) => {
            if (eventType === 'change') {
                console.log('‚ö° httpd.conf changed - immediate cleanup...');
                setTimeout(() => {
                    cleanupHttpdConf();
                }, 100);
            }
        });
        
        console.log('üõ°Ô∏è httpd.conf enhanced monitoring system activated');
        
    } catch (error) {
        console.error('Error setting up httpd.conf watcher:', error);
    }
}

// ÿØÿßŸÑÿ© ŸÑÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ Apache
function restartApache() {
    try {
        // ÿ•ŸäŸÇÿßŸÅ Apache
        const stopResult = spawn('taskkill', ['/F', '/IM', 'httpd.exe'], {
            stdio: 'ignore',
            detached: false
        });
        
        setTimeout(() => {
            // ÿ™ÿ¥ÿ∫ŸäŸÑ Apache
            startApache();
        }, 2000);
        
    } catch (error) {
        console.error('Error restarting Apache:', error);
    }
}

// ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ≥ÿ±Ÿäÿπ
async function performQuickInstall(appType, projectName) {
  const app = quickInstallApps[appType];
  const projectPath = path.join(baseDir, 'www', projectName);
  const domain = `${projectName}.test`;
  
  // ŸÅÿ≠ÿµ ÿßŸÑŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ÿ£ŸàŸÑÿßŸã
  console.log('Checking requirements for', app.name);
  const requirementsCheck = await checkRequirements(app.requirements);
  if (!requirementsCheck.allMet) {
    dialog.showErrorBox('ŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ŸÖŸÅŸÇŸàÿØÿ©', 
      `ÿßŸÑŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ™ÿßŸÑŸäÿ© ŸÖŸÅŸÇŸàÿØÿ©:\n${requirementsCheck.missing.join('\n')}\n\nŸäÿ±ÿ¨Ÿâ ÿ™ÿ´ÿ®Ÿäÿ™Ÿáÿß ÿ£ŸàŸÑÿßŸã.`);
    return;
  }
  
  console.log('All requirements met, starting installation...');
  
  // ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ŸÇÿØŸÖ
  createProgressWindow(`ÿ™ÿ´ÿ®Ÿäÿ™ ${app.name}`, `ÿ¨ÿßÿ±Ÿä ÿ™ÿ´ÿ®Ÿäÿ™ ${app.name}...`);
  
  try {
    let stepIndex = 0;
    const totalSteps = app.steps.length;
    
    for (const step of app.steps) {
      stepIndex++;
      const progress = Math.round((stepIndex / totalSteps) * 100);
      
      updateProgressWindow(
        `${step.description}...`,
        progress,
        `ÿßŸÑÿÆÿ∑Ÿàÿ© ${stepIndex} ŸÖŸÜ ${totalSteps}: ${step.description}`
      );
      
      await new Promise(resolve => setTimeout(resolve, 500)); // ÿ™ÿ£ÿÆŸäÿ± ÿ®ÿµÿ±Ÿä
      
      switch (step.type) {
        case 'download':
          await downloadAndExtract(app.downloadUrl, projectPath);
          break;
          
        case 'extract':
          // ÿ™ŸÖ ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπŸá ŸÅŸä download
          break;
          
        case 'command':
          await executeCommand(step.cmd, [...step.args, projectName], path.join(baseDir, 'www'));
          break;
          
        case 'database':
          if (app.database) {
            try {
              await createDatabase(projectName);
            } catch (error) {
              console.warn('Failed to create database:', error.message);
              
              // ÿπÿ±ÿ∂ ÿ™ÿ≠ÿ∞Ÿäÿ± ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸàŸÑŸÉŸÜ ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©
              updateProgressWindow(
                'ÿ™ÿ≠ÿ∞Ÿäÿ±: ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
                Math.round((stepIndex / totalSteps) * 100),
                `ÿ™ŸÖ ÿ™ÿÆÿ∑Ÿä ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™.\nŸäŸÖŸÉŸÜŸÉ ÿ•ŸÜÿ¥ÿßÿ§Ÿáÿß ŸäÿØŸàŸäÿßŸã ŸÑÿßÿ≠ŸÇÿßŸã.\nÿßÿ≥ŸÖ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: ${projectName}_db`
              );
              
              // ÿ•ŸÜÿ™ÿ∏ÿßÿ± ŸÇŸÑŸäŸÑ ŸÑŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
              await new Promise(resolve => setTimeout(resolve, 2000));
            }
          }
          break;
          
        case 'config':
          await configureProject(appType, projectName, projectPath);
          break;
          
        case 'npm-install':
          try {
            await executeCommand('npm', ['install'], projectPath);
          } catch (error) {
            console.warn('npm install failed, continuing anyway:', error.message);
            // ŸÑÿß ŸÜŸàŸÇŸÅ ÿßŸÑÿπŸÖŸÑŸäÿ©ÿå ÿ≥ŸÜÿ™ÿßÿ®ÿπ ÿ®ÿØŸàŸÜ npm install
          }
          break;
          
        case 'app-key':
          if (appType === 'laravel') {
            try {
              await executeCommand('php', ['artisan', 'key:generate'], projectPath);
            } catch (error) {
              console.warn('Failed to generate app key:', error.message);
            }
          }
          break;
          
        case 'migrate':
          if (appType === 'laravel') {
            try {
              // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ MySQL ŸäÿπŸÖŸÑ ÿ£ŸàŸÑÿßŸã
              if (!isServiceRunning('mysql')) {
                console.log('Trying to start MySQL...');
                await startMySQL();
                await new Promise(resolve => setTimeout(resolve, 3000));
              }
              
              // ŸÅÿ≠ÿµ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ£ŸàŸÑÿßŸã
              await executeCommand('php', ['artisan', 'migrate:status'], projectPath);
              
              // ÿ™ÿ¥ÿ∫ŸäŸÑ migrations
              await executeCommand('php', ['artisan', 'migrate', '--force'], projectPath);
            } catch (error) {
              console.warn('Failed to run migrations:', error.message);
              
              // ÿπÿ±ÿ∂ ÿ™ÿ≠ÿ∞Ÿäÿ± ŸÖŸÅÿµŸÑ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
              updateProgressWindow(
                'ÿ™ÿ≠ÿ∞Ÿäÿ±: ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ Migrations',
                Math.round((stepIndex / totalSteps) * 100),
                `ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ¥ÿ∫ŸäŸÑ migrations ŸÑÿßÿ≠ŸÇÿßŸã:\n1. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ¥ÿ∫ŸäŸÑ MySQL\n2. ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: ${projectName}_db\n3. ÿ™ÿ¥ÿ∫ŸäŸÑ: php artisan migrate`
              );
              
              await new Promise(resolve => setTimeout(resolve, 2000));
            }
          }
          break;
          
        case 'npm-build':
          try {
            await executeCommand('npm', ['run', 'build'], projectPath);
          } catch (error) {
            console.warn('npm run build failed, continuing without building assets:', error.message);
            // ŸÑÿß ŸÜŸàŸÇŸÅ ÿßŸÑÿπŸÖŸÑŸäÿ©ÿå ŸäŸÖŸÉŸÜ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ npm run dev ŸÑÿßÿ≠ŸÇÿßŸã
          }
          break;
          
        case 'domain':
          // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ addVirtualHost ŸÅŸÇÿ∑ ŸÑŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ≥ÿ±Ÿäÿπ ŸÑÿ£ŸÜŸáÿß ÿ™ÿØÿπŸÖ Laravel ŸàÿßŸÑFrameworks ÿßŸÑÿ£ÿÆÿ±Ÿâ
          addVirtualHost(projectName, appType);
          try {
            addToHosts(domain);
          } catch (hostsError) {
            console.error('Error updating hosts file:', hostsError);
            // ÿ≥ŸÜÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßŸÑÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÜŸáÿßŸäÿ©
          }
          break;
      }
    }
    
    // ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™
    updateProgressWindow('ÿ™ŸÖ ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!', 100, 'ÿ¨ÿßÿ±Ÿä ŸÅÿ™ÿ≠ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ...');
    
    setTimeout(() => {
      closeProgressWindow();
      
      // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÜÿ¨ÿßÿ≠ ŸÖÿπ ÿÆŸäÿßÿ±ÿßÿ™
      dialog.showMessageBox(null, {
        type: 'info',
        title: 'ÿ™ŸÖ ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!',
        message: `ÿ™ŸÖ ÿ™ÿ´ÿ®Ÿäÿ™ ${app.name} ÿ®ŸÜÿ¨ÿßÿ≠!`,
        detail: `ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ: ${projectName}\nÿßŸÑŸÖÿ¨ŸÑÿØ: ${projectPath}\nÿßŸÑÿ±ÿßÿ®ÿ∑: http://${domain}\n${app.database ? `ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: ${projectName}_db` : ''}`,
        buttons: ['ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàŸÇÿπ', 'ŸÅÿ™ÿ≠ ÿßŸÑŸÖÿ¨ŸÑÿØ', 'ŸÖŸàÿßŸÅŸÇ']
      }).then((result) => {
        if (result.response === 0) {
          // ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàŸÇÿπ
          shell.openExternal(`http://${domain}`);
        } else if (result.response === 1) {
          // ŸÅÿ™ÿ≠ ÿßŸÑŸÖÿ¨ŸÑÿØ
          shell.openPath(projectPath);
        }
      });
      
      refreshMenu();
      showNotification(`ÿ™ŸÖ ÿ™ÿ´ÿ®Ÿäÿ™ ${app.name}`, `ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ${projectName} ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ!`);
      
    }, 1000);
    
  } catch (error) {
    closeProgressWindow();
    dialog.showErrorBox('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™', `ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ´ÿ®Ÿäÿ™ ${app.name}:\n${error.message}`);
  }
}

// ÿ™ÿ≠ŸÖŸäŸÑ Ÿàÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÖŸÑŸÅÿßÿ™
async function downloadAndExtract(downloadUrl, targetPath) {
  return new Promise((resolve, reject) => {
    const tempZip = path.join(baseDir, 'tmp', 'download.zip');
    
    // ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¨ŸÑÿØ tmp ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸã
    const tmpDir = path.dirname(tempZip);
    if (!fs.existsSync(tmpDir)) {
      fs.mkdirSync(tmpDir, { recursive: true });
    }
    
    const file = fs.createWriteStream(tempZip);
    
    https.get(downloadUrl, (response) => {
      if (response.statusCode === 302 || response.statusCode === 301) {
        return downloadAndExtract(response.headers.location, targetPath);
      }
      
      response.pipe(file);
      
      file.on('finish', async () => {
        file.close();
        
        try {
          // ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÖŸÑŸÅÿßÿ™
          await extract(tempZip, { dir: path.dirname(targetPath) });
          
          // ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑŸÖÿ¨ŸÑÿØ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ Ÿàÿ•ÿπÿßÿØÿ© ÿ™ÿ≥ŸÖŸäÿ™Ÿá
          const extractedFiles = fs.readdirSync(path.dirname(targetPath));
          const extractedFolder = extractedFiles.find(name => 
            name !== path.basename(targetPath) && 
            fs.statSync(path.join(path.dirname(targetPath), name)).isDirectory()
          );
          
          if (extractedFolder) {
            const extractedPath = path.join(path.dirname(targetPath), extractedFolder);
            if (fs.existsSync(targetPath)) {
              fs.rmSync(targetPath, { recursive: true, force: true });
            }
            fs.renameSync(extractedPath, targetPath);
          }
          
          // ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™
          fs.unlinkSync(tempZip);
          resolve();
          
        } catch (error) {
          reject(error);
        }
      });
      
    }).on('error', (error) => {
      reject(error);
    });
  });
}

// ÿ™ŸÜŸÅŸäÿ∞ ÿ£ŸàÿßŸÖÿ± ÿßŸÑŸÜÿ∏ÿßŸÖ
async function executeCommand(cmd, args, cwd) {
  return new Promise((resolve, reject) => {
    console.log(`Running command: ${cmd} ${args.join(' ')} in ${cwd}`);
    
    // ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑÿµÿ≠Ÿäÿ≠ ŸÑŸÑÿ£ŸàÿßŸÖÿ±
    let fullCmd = cmd;
    if (cmd === 'php') {
      fullCmd = path.join(baseDir, 'bin', 'php', 'php.exe');
    } else if (cmd === 'composer') {
      // ÿ≥ŸÜÿ≥ÿ™ÿÆÿØŸÖ composer.phar ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ™ŸàŸÅÿ±
      const composerPath = path.join(baseDir, 'bin', 'composer.phar');
      if (fs.existsSync(composerPath)) {
        const phpPath = path.join(baseDir, 'bin', 'php', 'php.exe');
        fullCmd = phpPath;
        args = [composerPath, ...args];
      }
    }
    
    const proc = spawn(fullCmd, args, { 
      cwd: cwd,
      stdio: ['ignore', 'pipe', 'pipe'],
      shell: true // ÿ•ÿ∂ÿßŸÅÿ© shell ŸÑŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ npm ÿπŸÑŸâ Windows
    });
    
    let output = '';
    let errorOutput = '';
    
    proc.stdout.on('data', (data) => {
      const text = data.toString();
      output += text;
      console.log(`stdout: ${text.trim()}`);
    });
    
    proc.stderr.on('data', (data) => {
      const text = data.toString();
      errorOutput += text;
      console.log(`stderr: ${text.trim()}`);
    });
    
    proc.on('close', (code) => {
      console.log(`Command finished with code: ${code}`);
      if (code === 0) {
        resolve(output);
      } else {
        reject(new Error(`Command failed with code ${code}:\nOutput: ${output}\nError: ${errorOutput}`));
      }
    });
    
    proc.on('error', (error) => {
      console.error(`Error running command: ${error.message}`);
      reject(error);
    });
  });
}

// ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿ¨ÿØŸäÿØÿ©
async function createDatabase(projectName) {
  // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿßÿ≥ŸÖ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ _db ÿ®ÿßŸÑŸÅÿπŸÑÿå ŸÑÿß ŸÜÿ∂ŸäŸÅŸá ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ
  const dbName = projectName.endsWith('_db') ? projectName : `${projectName}_db`;
  
  // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ MySQL client ŸÅŸä ŸÖÿ≥ÿßÿ±ÿßÿ™ ŸÖÿÆÿ™ŸÑŸÅÿ©
  const possibleMysqlPaths = [
    path.join(baseDir, 'bin', 'mysql', 'bin', 'mysql.exe'),
    path.join(baseDir, 'bin', 'mysql', 'mysql.exe'),
    'mysql', // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ´ÿ®ÿ™ globally
  ];
  
  let mysqlPath = null;
  
  for (const testPath of possibleMysqlPaths) {
    if (testPath === 'mysql') {
      // ÿ≥ŸÜÿÆÿ™ÿ®ÿ± Ÿáÿ∞ÿß ÿπŸÜÿØ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ
      mysqlPath = testPath;
      break;
    } else if (fs.existsSync(testPath)) {
      mysqlPath = testPath;
      break;
    }
  }
  
  if (!mysqlPath) {
    console.warn('MySQL client not found, skipping database creation');
    throw new Error('MySQL client ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ. ŸäŸÖŸÉŸÜŸÉ ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸäÿØŸàŸäÿßŸã ŸÑÿßÿ≠ŸÇÿßŸã.\nÿßÿ≥ŸÖ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©: ' + dbName);
  }
  
  // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ¥ÿ∫ŸäŸÑ MySQL server
  if (!isServiceRunning('mysql')) {
    console.log('MySQL server not running, trying to start it...');
    try {
      await startMySQL();
      // ÿßŸÜÿ™ÿ∏ÿßÿ± ŸÇŸÑŸäŸÑ ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ®ÿØÿ° ÿßŸÑÿÆÿØŸÖÿ©
      await new Promise(resolve => setTimeout(resolve, 3000));
    } catch (error) {
      throw new Error('ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ MySQL server. Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ¥ÿ∫ŸäŸÑŸá ŸäÿØŸàŸäÿßŸã ÿ´ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: ' + dbName);
    }
  }
  
  // ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
  const createDbCommand = `CREATE DATABASE IF NOT EXISTS \`${dbName}\` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;`;
  
  try {
    // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ exec ÿ®ÿØŸÑÿßŸã ŸÖŸÜ spawn ŸÑÿ™ÿ¨ŸÜÿ® ŸÖÿ¥ÿßŸÉŸÑ Windows
    const command = `"${mysqlPath}" -h localhost -P 3306 -u root -e "${createDbCommand}"`;
    
    await new Promise((resolve, reject) => {
      exec(command, { cwd: baseDir }, (error, stdout, stderr) => {
        if (error) {
          reject(error);
        } else {
          resolve(stdout);
        }
      });
    });
    
    console.log(`Database ${dbName} created successfully`);
    
  } catch (error) {
    console.error('Error creating database:', error);
    
    // ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑÿå ŸÜÿπÿ∑Ÿä ÿ±ÿ≥ÿßŸÑÿ© ŸÖŸÅŸäÿØÿ© ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
    if (error.code === 'ENOENT') {
      throw new Error(`MySQL client ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ±: ${mysqlPath}\n\nŸäŸÖŸÉŸÜŸÉ:\n1. ÿ™ÿ´ÿ®Ÿäÿ™ MySQL\n2. ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸäÿØŸàŸäÿßŸã: ${dbName}\n3. ÿ£Ÿà ÿßÿ≥ÿ™ŸÉŸÖÿßŸÑ ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿ®ÿØŸàŸÜ ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™`);
    } else if (error.message.includes('Access denied')) {
      throw new Error(`ÿÆÿ∑ÿ£ ŸÅŸä ÿµŸÑÿßÿ≠Ÿäÿßÿ™ MySQL\n\nÿ™ÿ£ŸÉÿØ ŸÖŸÜ:\n1. MySQL ŸäÿπŸÖŸÑ\n2. ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ root ŸÖÿ™ÿßÿ≠\n3. ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿµÿ≠Ÿäÿ≠ÿ©\n\nŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©: ${dbName}`);
    } else {
      throw new Error(`ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: ${error.message}\n\nÿßÿ≥ŸÖ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: ${dbName}`);
    }
  }
}

// ÿ™ŸÉŸàŸäŸÜ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ
async function configureProject(appType, projectName, projectPath) {
  const dbName = `${projectName}_db`;
  
  switch (appType) {
    case 'laravel':
      await configureLaravel(projectPath, dbName);
      break;
      
    case 'wordpress':
      await configureWordPress(projectPath, dbName);
      break;
      
    case 'codeigniter':
      await configureCodeIgniter(projectPath, dbName);
      break;
      
    case 'symfony':
      await configureSymfony(projectPath, dbName);
      break;
      
    case 'cakephp':
      await configureCakePHP(projectPath, dbName);
      break;
  }
}

// ÿ™ŸÉŸàŸäŸÜ Laravel
async function configureLaravel(projectPath, dbName) {
  const envPath = path.join(projectPath, '.env');
  const envExamplePath = path.join(projectPath, '.env.example');
  
  let envContent = '';
  
  // ŸÖÿ≠ÿßŸàŸÑÿ© ŸÇÿ±ÿßÿ°ÿ© ŸÖŸÑŸÅ .env ÿßŸÑŸÖŸàÿ¨ŸàÿØ
  if (fs.existsSync(envPath)) {
    envContent = fs.readFileSync(envPath, 'utf8');
  }
  // ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸàÿ¨ÿØ ŸÖŸÑŸÅ .envÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ .env.example ŸÉŸÇÿßŸÑÿ®
  else if (fs.existsSync(envExamplePath)) {
    envContent = fs.readFileSync(envExamplePath, 'utf8');
    console.log('Using .env.example as template to create .env');
  }
  // ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸàÿ¨ÿØ ÿ£Ÿä ŸÖŸÜŸáŸÖÿßÿå ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ≠ÿ™ŸàŸâ ÿ£ÿ≥ÿßÿ≥Ÿä
  else {
    console.log('Creating new .env file from scratch');
         envContent = `APP_NAME=Laravel
APP_ENV=local
APP_KEY=
APP_DEBUG=true
APP_URL=http://${path.basename(projectPath)}.test

LOG_CHANNEL=stack
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=${dbName}
DB_USERNAME=root
DB_PASSWORD=

BROADCAST_DRIVER=log
CACHE_DRIVER=file
FILESYSTEM_DISK=local
QUEUE_CONNECTION=sync
SESSION_DRIVER=file
SESSION_LIFETIME=120

MEMCACHED_HOST=127.0.0.1

REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

MAIL_MAILER=smtp
MAIL_HOST=mailpit
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="\${APP_NAME}"

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=
AWS_USE_PATH_STYLE_ENDPOINT=false

PUSHER_APP_ID=
PUSHER_APP_KEY=
PUSHER_APP_SECRET=
PUSHER_HOST=
PUSHER_PORT=443
PUSHER_SCHEME=https
PUSHER_APP_CLUSTER=mt1

VITE_APP_NAME="\${APP_NAME}"
VITE_PUSHER_APP_KEY="\${PUSHER_APP_KEY}"
VITE_PUSHER_HOST="\${PUSHER_HOST}"
VITE_PUSHER_PORT="\${PUSHER_PORT}"
VITE_PUSHER_SCHEME="\${PUSHER_SCHEME}"
VITE_PUSHER_APP_CLUSTER="\${PUSHER_APP_CLUSTER}"`;
  }
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿπÿØÿßÿØÿßÿ™ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸàÿßŸÑÿØŸàŸÖŸäŸÜ
  const projectName = path.basename(projectPath);
  const appSettings = {
    'APP_URL': `http://${projectName}.test`,
    'DB_CONNECTION': 'mysql',
    'DB_HOST': '127.0.0.1',
    'DB_PORT': '3306',
    'DB_DATABASE': dbName,
    'DB_USERNAME': 'root',
    'DB_PASSWORD': ''
  };
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿ£Ÿà ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸÑ ÿ•ÿπÿØÿßÿØ
  Object.entries(appSettings).forEach(([key, value]) => {
    const regex = new RegExp(`^${key}=.*$`, 'm');
    if (regex.test(envContent)) {
      // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ©
      envContent = envContent.replace(regex, `${key}=${value}`);
           } else {
         // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇŸäŸÖÿ© ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿ©
         if (key === 'APP_URL') {
           // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÇÿ≥ŸÖ APP
           const appSectionRegex = /^APP_NAME=.*$/m;
           if (appSectionRegex.test(envContent)) {
             // ÿ•ÿ∂ÿßŸÅÿ© ÿ®ÿπÿØ APP_NAME
             envContent = envContent.replace(appSectionRegex, `$&\n${key}=${value}`);
           } else {
             // ÿ•ÿ∂ÿßŸÅÿ© ŸÅŸä ÿ®ÿØÿßŸäÿ© ÿßŸÑŸÖŸÑŸÅ
             envContent = `${key}=${value}\n` + envContent;
           }
         } else {
           // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÇÿ≥ŸÖ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
           const dbSectionRegex = /^DB_CONNECTION=.*$/m;
           if (dbSectionRegex.test(envContent)) {
             // ÿ•ÿ∂ÿßŸÅÿ© ÿ®ÿπÿØ DB_CONNECTION
             envContent = envContent.replace(dbSectionRegex, `DB_CONNECTION=mysql\n${key}=${value}`);
           } else {
             // ÿ•ÿ∂ÿßŸÅÿ© ŸÅŸä ŸÜŸáÿßŸäÿ© ÿßŸÑŸÖŸÑŸÅ
             envContent += `\n${key}=${value}`;
           }
         }
       }
  });
  
  // ÿ≠ŸÅÿ∏ ŸÖŸÑŸÅ .env
  fs.writeFileSync(envPath, envContent, 'utf8');
  
  // ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
  await createDatabase(dbName);
  
  console.log(`Laravel configured with database: ${dbName} and domain: ${projectName}.test`);
}

// ÿ™ŸÉŸàŸäŸÜ WordPress
async function configureWordPress(projectPath, dbName) {
  const configPath = path.join(projectPath, 'wp-config.php');
  const sampleConfigPath = path.join(projectPath, 'wp-config-sample.php');
  
  if (fs.existsSync(sampleConfigPath) && !fs.existsSync(configPath)) {
    let configContent = fs.readFileSync(sampleConfigPath, 'utf8');
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿπÿØÿßÿØÿßÿ™ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    configContent = configContent.replace(/database_name_here/g, dbName);
    configContent = configContent.replace(/username_here/g, 'root');
    configContent = configContent.replace(/password_here/g, '');
    configContent = configContent.replace(/localhost/g, 'localhost');
    
    // ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑÿ£ŸÖÿßŸÜ
    const saltKeys = [
      'AUTH_KEY', 'SECURE_AUTH_KEY', 'LOGGED_IN_KEY', 'NONCE_KEY',
      'AUTH_SALT', 'SECURE_AUTH_SALT', 'LOGGED_IN_SALT', 'NONCE_SALT'
    ];
    
    saltKeys.forEach(key => {
      const randomKey = generateRandomString(64);
      configContent = configContent.replace(
        new RegExp(`define\\('${key}',\\s*'put your unique phrase here'\\);`),
        `define('${key}', '${randomKey}');`
      );
    });
    
    fs.writeFileSync(configPath, configContent);
  }
}

// ÿ™ŸÉŸàŸäŸÜ CodeIgniter
async function configureCodeIgniter(projectPath, dbName) {
  const configPath = path.join(projectPath, 'app', 'Config', 'Database.php');
  
  if (fs.existsSync(configPath)) {
    let configContent = fs.readFileSync(configPath, 'utf8');
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿπÿØÿßÿØÿßÿ™ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    configContent = configContent.replace(/'database'\s*=>\s*'[^']*'/, `'database' => '${dbName}'`);
    configContent = configContent.replace(/'username'\s*=>\s*'[^']*'/, `'username' => 'root'`);
    configContent = configContent.replace(/'password'\s*=>\s*'[^']*'/, `'password' => ''`);
    
    fs.writeFileSync(configPath, configContent);
  }
}

// ÿ™ŸÉŸàŸäŸÜ Symfony
async function configureSymfony(projectPath, dbName) {
  const envPath = path.join(projectPath, '.env');
  
  if (fs.existsSync(envPath)) {
    let envContent = fs.readFileSync(envPath, 'utf8');
    
    // ÿ™ÿ≠ÿØŸäÿ´ DATABASE_URL
    const databaseUrl = `mysql://root:@127.0.0.1:3306/${dbName}?serverVersion=8.0&charset=utf8mb4`;
    envContent = envContent.replace(/DATABASE_URL=.*/, `DATABASE_URL="${databaseUrl}"`);
    
    fs.writeFileSync(envPath, envContent);
  }
}

// ÿ™ŸÉŸàŸäŸÜ CakePHP
async function configureCakePHP(projectPath, dbName) {
  const configPath = path.join(projectPath, 'config', 'app_local.php');
  
  const localConfig = `<?php
return [
    'Datasources' => [
        'default' => [
            'host' => 'localhost',
            'username' => 'root',
            'password' => '',
            'database' => '${dbName}',
            'port' => '3306',
        ],
    ],
];`;

  fs.writeFileSync(configPath, localConfig);
}

// ŸÅÿ≠ÿµ ŸÖÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖŸÜŸÅÿ∞ ŸÖÿ™ÿßÿ≠ÿßŸã
function isPortAvailable(port) {
  const net = require('net');
  return new Promise((resolve) => {
    const server = net.createServer();
    server.listen(port, () => {
      server.once('close', () => resolve(true));
      server.close();
    });
    server.on('error', () => resolve(false));
  });
}

// Render a Mustache template and write to destination
function renderTemplate(srcTpl, dest, vars) {
  const tplPath = path.join(baseDir, 'config', srcTpl);
  const tpl     = fs.readFileSync(tplPath, 'utf8');
  const out     = mustache.render(tpl, vars);
  fs.writeFileSync(dest, out, 'utf8');
}

// Generate MySQL configuration file
function generateMySQLConfig() {
  // Ensure tmp directory exists
  const tmpDir = path.join(baseDir, 'tmp');
  if (!fs.existsSync(tmpDir)) {
    fs.mkdirSync(tmpDir, { recursive: true });
  }
  
  // Create config directly without templates to avoid HTML encoding
  const mysqlBasedir = path.join(baseDir, 'bin', 'mysql').replace(/\\/g, '/');
  const mysqlDatadir = path.join(baseDir, 'bin', 'mysql', 'data').replace(/\\/g, '/');
  const mysqlTmpdir = path.join(baseDir, 'tmp').replace(/\\/g, '/');
  
  const config = `[client]
port=3306
default-character-set=utf8mb4

[mysqld]
port=3306
basedir="${mysqlBasedir}"
tmpdir="${mysqlTmpdir}"
datadir="${mysqlDatadir}"
pid_file="mysql.pid"
key_buffer_size=16M
max_allowed_packet=1M
sort_buffer_size=512K
net_buffer_length=8K
read_buffer_size=256K
read_rnd_buffer_size=512K
myisam_sort_buffer_size=8M
log_error="mysql_error.log"

# Bind to localhost only for security
bind-address="127.0.0.1"

# Character set (server settings)
character-set-server=utf8mb4
collation-server=utf8mb4_general_ci

# InnoDB settings
innodb_data_home_dir="${mysqlDatadir}"
innodb_data_file_path=ibdata1:10M:autoextend
innodb_log_group_home_dir="${mysqlDatadir}"
innodb_buffer_pool_size=16M
innodb_log_file_size=5M
innodb_log_buffer_size=8M
innodb_flush_log_at_trx_commit=1
innodb_lock_wait_timeout=50

# SQL Mode
sql_mode=NO_ZERO_IN_DATE,NO_ZERO_DATE,NO_ENGINE_SUBSTITUTION
log_bin_trust_function_creators=1

[mysqldump]
max_allowed_packet=16M

[mysql]
default-character-set=utf8mb4

[isamchk]
key_buffer_size=20M
sort_buffer_size=20M
read_buffer=2M
write_buffer=2M

[myisamchk]
key_buffer_size=20M
sort_buffer_size=20M
read_buffer=2M
write_buffer=2M`;

  const configPath = path.join(baseDir, 'config', 'my.ini');
  fs.writeFileSync(configPath, config);
  console.log('MySQL configuration generated successfully');
}

// Test MySQL configuration
function testMySQLConfig() {
  generateMySQLConfig();
  const configPath = path.join(baseDir, 'config', 'my.ini');
  const proc = spawn(path.join(baseDir, 'bin', 'mysql', 'bin', 'mysqld.exe'), [
    '--defaults-file=' + configPath,
    '--help',
    '--verbose'
  ], {
    stdio: ['ignore', 'pipe', 'pipe']
  });
  
  let output = '';
  proc.stdout.on('data', (data) => output += data.toString());
  proc.stderr.on('data', (data) => output += data.toString());
  
  proc.on('close', (code) => {
    if (code === 0) {
      dialog.showMessageBox(null, {
        type: 'info',
        title: 'ÿßÿÆÿ™ÿ®ÿßÿ± ÿ™ŸÉŸàŸäŸÜ MySQL',
        message: 'ÿ™ŸÉŸàŸäŸÜ MySQL ÿµÿ≠Ÿäÿ≠ ‚úÖ',
        detail: 'MySQL ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ™ÿ¥ÿ∫ŸäŸÑ'
      });
    } else {
      dialog.showMessageBox(null, {
        type: 'error',
        title: 'ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸÉŸàŸäŸÜ MySQL',
        message: `ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÉŸàŸäŸÜ (Code: ${code})`,
        detail: output.length > 500 ? output.substring(0, 500) + '...' : output
      });
    }
  });
}

// Start a service by spawning its executable
function startService(name, exePath, args = []) {
  if (processes[name] && !processes[name].killed) return;
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞Ÿä
  if (!fs.existsSync(exePath)) {
    dialog.showErrorBox('ÿÆÿ∑ÿ£', `ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ${name} ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ±:\n${exePath}`);
    return;
  }
  
  const proc = spawn(exePath, args, { 
    cwd: path.dirname(exePath),
    stdio: ['ignore', 'pipe', 'pipe'] // ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£
  });
  
  // ŸÖÿπÿßŸÑÿ¨ÿ© ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£
  proc.stderr.on('data', (data) => {
    console.error(`${name} Error:`, data.toString());
  });
  
  proc.on('exit', (code) => {
    processes[name] = null;
    if (code !== 0 && code !== null) {
      dialog.showErrorBox('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿÆÿØŸÖÿ©', `${name} ÿ™ŸàŸÇŸÅ ÿ®ÿ±ŸÖÿ≤ ÿßŸÑÿÆÿ∑ÿ£: ${code}`);
    }
    refreshMenu();
  });
  
  proc.on('error', (err) => {
    processes[name] = null;
    dialog.showErrorBox('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿÆÿØŸÖÿ©', `ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ ${name}:\n${err.message}`);
    refreshMenu();
  });
  
  processes[name] = proc;
  setTimeout(refreshMenu, 1000); // ÿ™ÿ£ÿÆŸäÿ± ŸÇÿµŸäÿ± ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ®ÿØÿ° ÿßŸÑÿπŸÖŸÑŸäÿ©
}

// Stop a running service
function stopService(name) {
  const proc = processes[name];
  if (!proc) return;
  proc.kill();
  processes[name] = null;
  refreshMenu();
}

// Check if a given service is currently running
function isServiceRunning(name) {
  const proc = processes[name];
  return proc && !proc.killed;
}

// Detect installed PHP versions in bin/php/
function detectPHPVersions() {
  const phpDir = path.join(baseDir, 'bin', 'php');
  if (!fs.existsSync(phpDir)) return [];
  
  return fs.readdirSync(phpDir)
    .filter(name => fs.statSync(path.join(phpDir, name)).isDirectory())
    .map(name => ({ name, path: path.join(phpDir, name) }));
}

let tray;

// Detect websites in www folder
function detectWebsites() {
  const wwwPath = path.join(baseDir, 'www');
  if (!fs.existsSync(wwwPath)) return [];
  
  return fs.readdirSync(wwwPath)
    .filter(item => {
      const itemPath = path.join(wwwPath, item);
      return fs.statSync(itemPath).isDirectory() && 
             item !== 'phpmyadmin'; // ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° ŸÖÿ¨ŸÑÿØ phpMyAdmin
    })
    .map(siteName => {
      // ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑÿµÿ≠Ÿäÿ≠ ŸÑŸÄ virtual hosts
      const vhostPath = path.join(baseDir, 'config', 'vhosts', `${siteName}.conf`);
      const hasVhost = fs.existsSync(vhostPath);
      const domain = `${siteName}.test`;
      
      return {
        name: siteName,
        path: path.join(wwwPath, siteName),
        hasIndex: fs.existsSync(path.join(wwwPath, siteName, 'index.html')) ||
                  fs.existsSync(path.join(wwwPath, siteName, 'index.php')),
        hasVhost: hasVhost,
        domain: domain,
        domainUrl: `http://${domain}`,
        url: `http://localhost/${siteName}`
      };
    });
}

// Get hosts file path
function getHostsFilePath() {
  if (os.platform() === 'win32') {
    return 'C:\\Windows\\System32\\drivers\\etc\\hosts';
  } else {
    return '/etc/hosts';
  }
}

// Add domain to hosts file
function addToHosts(domain) {
  const hostsPath = getHostsFilePath();
  const entry = `127.0.0.1 ${domain}`;
  
  try {
    // Check if we have permission to read the hosts file
    if (!fs.existsSync(hostsPath)) {
      console.error('Hosts file not found');
      return false;
    }
    
    const hostsContent = fs.readFileSync(hostsPath, 'utf8');
    if (!hostsContent.includes(domain)) {
      fs.appendFileSync(hostsPath, `\n# MyDevBox - ${domain}\n${entry}\n`);
      return true;
    }
    return true; // Already exists
  } catch (error) {
    console.error('Error updating hosts file:', error);
    // If permission denied, suggest running as admin
    if (error.code === 'EACCES' || error.code === 'EPERM') {
      dialog.showErrorBox('ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸäÿ©', 
        'ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑŸÅ hosts. Ÿäÿ±ÿ¨Ÿâ:\n' +
        '1. ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨\n' +
        '2. ÿ™ÿ¥ÿ∫ŸäŸÑŸá ÿ®ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸÖÿØŸäÿ±\n' +
        '3. ÿ£Ÿà ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ "ÿ£ÿØÿßÿ© ÿ•ÿπÿØÿßÿØ Hosts"'
      );
    }
    return false;
  }
}

// Remove domain from hosts file
function removeFromHosts(domain) {
  const hostsPath = getHostsFilePath();
  
  try {
    let hostsContent = fs.readFileSync(hostsPath, 'utf8');
    const lines = hostsContent.split('\n');
    const filteredLines = lines.filter(line => 
      !line.includes(domain) && !line.includes(`# MyDevBox - ${domain}`)
    );
    fs.writeFileSync(hostsPath, filteredLines.join('\n'));
    return true;
  } catch (error) {
    console.error('Error updating hosts file:', error);
    return false;
  }
}

// Create virtual host configuration
function createVirtualHost(siteName, sitePath, appType = null) {
  const vhostPath = path.join(baseDir, 'config', 'vhosts', `${siteName}.conf`);
  
  try {
    let documentRoot = sitePath.replace(/\\/g, '/');
    let directoryPath = documentRoot;
    
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÜŸàÿπ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ - ÿ•ÿ∞ÿß ŸÉÿßŸÜ Laravel ÿ£Ÿà framework ÿ¢ÿÆÿ± Ÿäÿ≠ÿ™ÿßÿ¨ public
    if (appType && ['laravel', 'symfony', 'cakephp'].includes(appType)) {
      documentRoot += '/public';
      directoryPath += '/public';
    } else {
      // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿßŸÑÿ∞ŸÉŸä ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÖÿ¨ŸÑÿØ public (Laravel detection)
      const publicPath = path.join(sitePath, 'public');
      const artisanPath = path.join(sitePath, 'artisan');
      
      if (fs.existsSync(publicPath) && fs.existsSync(artisanPath)) {
        // Ÿáÿ∞ÿß ŸÖÿ¥ÿ±Ÿàÿπ Laravel
        documentRoot += '/public';
        directoryPath += '/public';
      }
    }
    
    const vhostContent = `# Virtual Host for ${siteName}.test
<VirtualHost *:80>
    ServerName ${siteName}.test
    ServerAlias www.${siteName}.test
    DocumentRoot "${documentRoot}"
    
    <Directory "${directoryPath}">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # Custom log files for this site
    ErrorLog "logs/${siteName}-error.log"
    CustomLog "logs/${siteName}-access.log" combined
</VirtualHost>`;
    
    fs.writeFileSync(vhostPath, vhostContent);
    return true;
  } catch (error) {
    console.error('Error creating virtual host:', error);
    return false;
  }
}

// Remove virtual host configuration
function removeVirtualHost(siteName) {
  const vhostPath = path.join(baseDir, 'config', 'vhosts', `${siteName}.conf`);
  
  try {
    if (fs.existsSync(vhostPath)) {
      fs.unlinkSync(vhostPath);
    }
    return true;
  } catch (error) {
    console.error('Error removing virtual host:', error);
    return false;
  }
}

// Create a new website
function createNewSite() {
  dialog.showMessageBox(null, {
    type: 'question',
    buttons: ['ÿ•ŸÜÿ¥ÿßÿ°', 'ÿ•ŸÑÿ∫ÿßÿ°'],
    title: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ ÿ¨ÿØŸäÿØ',
    message: 'ŸÖÿß ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿ¨ÿØŸäÿØÿü',
    detail: 'ÿ≥Ÿäÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¨ŸÑÿØ ÿ¨ÿØŸäÿØ ŸÅŸä www/'
  }).then(result => {
    if (result.response === 0) {
      // Show input dialog for site name
      const siteName = require('electron').dialog.showSaveDialogSync(null, {
        title: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàŸÇÿπ',
        defaultPath: path.join(baseDir, 'www', 'new-site'),
        properties: ['createDirectory']
      });
      
      if (siteName) {
        const siteFolder = path.basename(siteName);
        const sitePath = path.join(baseDir, 'www', siteFolder);
        
        if (!fs.existsSync(sitePath)) {
          fs.mkdirSync(sitePath, { recursive: true });
          
          // Create Virtual Host
          const vhostCreated = createVirtualHost(siteFolder, sitePath);
          
          // Add to hosts file
          const domain = `${siteFolder}.test`;
          const hostsUpdated = addToHosts(domain);
          
          // Create basic index.php
          const indexContent = `<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${siteFolder}</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; padding: 50px; }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { color: #2c3e50; }
        .info { background: #ecf0f1; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .success { color: #27ae60; }
        .warning { color: #f39c12; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéâ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ${siteFolder}</h1>
        <div class="info">
            <p><strong>ÿßŸÑŸÖÿ≥ÿßÿ±:</strong> ${sitePath}</p>
            <p><strong>ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä:</strong> <a href="http://${domain}" class="success">${domain}</a></p>
            <p><strong>ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ™ŸÇŸÑŸäÿØŸä:</strong> <a href="http://localhost/${siteFolder}">localhost/${siteFolder}</a></p>
            <p><strong>ÿßŸÑŸàŸÇÿ™:</strong> <?php echo date('Y-m-d H:i:s'); ?></p>
        </div>
        ${!hostsUpdated ? '<p class="warning">‚ö†Ô∏è ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨ ŸÉŸÖÿØŸäÿ± ŸÑÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜ</p>' : ''}
        <p>ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿßŸÑÿ®ÿØÿ° ŸÅŸä ÿ™ÿ∑ŸàŸäÿ± ŸÖŸàŸÇÿπŸÉ!</p>
    </div>
</body>
</html>`;
          
          fs.writeFileSync(path.join(sitePath, 'index.php'), indexContent);
          
          let message = `ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ "${siteFolder}" ÿ®ŸÜÿ¨ÿßÿ≠!`;
          let detail = `ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä: http://${domain}`;
          
          if (!hostsUpdated) {
            detail += '\n‚ö†Ô∏è ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑŸÅ hosts - ŸÇŸÖ ÿ®ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨ ŸÉŸÖÿØŸäÿ±';
          }
          
          if (!vhostCreated) {
            detail += '\n‚ö†Ô∏è ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° Virtual Host';
          }
          
          dialog.showMessageBox(null, {
            type: vhostCreated && hostsUpdated ? 'info' : 'warning',
            title: 'ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ',  
            message: message,
            detail: detail
          });
          
          // Restart Apache to apply changes
          if (isServiceRunning('apache')) {
            stopService('apache');
            setTimeout(() => {
              startService('apache', path.join(baseDir, 'bin', 'apache', 'bin', 'httpd.exe'), ['-f', path.join(baseDir, 'bin', 'apache', 'conf', 'mydevbox.conf')]);
            }, 2000);
          }
          
          refreshMenu();
        }
      }
    }
  });
}

// Create domain for existing site
function createSiteDomain(siteName, sitePath) {
  const domain = `${siteName}.test`;
  
  dialog.showMessageBox(null, {
    type: 'question',
    buttons: ['ÿ•ŸÜÿ¥ÿßÿ°', 'ÿ•ŸÑÿ∫ÿßÿ°'],
    title: 'ÿ•ŸÜÿ¥ÿßÿ° ÿØŸàŸÖŸäŸÜ ŸÖÿ≠ŸÑŸä',
    message: `ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿØŸàŸÖŸäŸÜ ${domain}ÿü`,
    detail: 'ÿ≥Ÿäÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© Virtual Host Ÿàÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑŸÅ hosts'
  }).then(result => {
    if (result.response === 0) {
      const vhostCreated = createVirtualHost(siteName, sitePath); // ÿ≥Ÿäÿ™ŸÖ ÿßŸÑŸÉÿ¥ŸÅ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä ÿπŸÜ Laravel
      const hostsUpdated = addToHosts(domain);
      
      let message = vhostCreated ? 'ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿØŸàŸÖŸäŸÜ ÿ®ŸÜÿ¨ÿßÿ≠!' : 'ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° Virtual Host';
      let detail = `ÿßŸÑÿØŸàŸÖŸäŸÜ: http://${domain}`;
      
      if (!hostsUpdated) {
        detail += '\n‚ö†Ô∏è ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑŸÅ hosts - ŸÇŸÖ ÿ®ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨ ŸÉŸÖÿØŸäÿ±';
      }
      
      dialog.showMessageBox(null, {
        type: vhostCreated && hostsUpdated ? 'info' : 'warning',
        title: 'ÿ•ŸÜÿ¥ÿßÿ° ÿØŸàŸÖŸäŸÜ',
        message: message,
        detail: detail
      });
      
      // Restart Apache
      if (isServiceRunning('apache')) {
        stopService('apache');
        setTimeout(() => {
          startService('apache', path.join(baseDir, 'bin', 'apache', 'bin', 'httpd.exe'), ['-f', path.join(baseDir, 'bin', 'apache', 'conf', 'mydevbox.conf')]);
        }, 2000);
      }
      
      refreshMenu();
    }
  });
}

// Remove domain for site
function removeSiteDomain(siteName) {
  const domain = `${siteName}.test`;
  
  dialog.showMessageBox(null, {
    type: 'question',
    buttons: ['ÿ≠ÿ∞ŸÅ', 'ÿ•ŸÑÿ∫ÿßÿ°'],
    title: 'ÿ≠ÿ∞ŸÅ ÿØŸàŸÖŸäŸÜ ŸÖÿ≠ŸÑŸä',
    message: `ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ ÿßŸÑÿØŸàŸÖŸäŸÜ ${domain}ÿü`,
    detail: 'ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ Virtual Host Ÿàÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿØŸàŸÖŸäŸÜ ŸÖŸÜ ŸÖŸÑŸÅ hosts'
  }).then(result => {
    if (result.response === 0) {
      const vhostRemoved = removeVirtualHost(siteName);
      const hostsUpdated = removeFromHosts(domain);
      
      dialog.showMessageBox(null, {
        type: 'info',
        title: 'ÿ≠ÿ∞ŸÅ ÿØŸàŸÖŸäŸÜ',
        message: 'ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿØŸàŸÖŸäŸÜ ÿ®ŸÜÿ¨ÿßÿ≠',
        detail: `ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ${domain}`
      });
      
      // Restart Apache
      if (isServiceRunning('apache')) {
        stopService('apache');
        setTimeout(() => {
          startService('apache', path.join(baseDir, 'bin', 'apache', 'bin', 'httpd.exe'), ['-f', path.join(baseDir, 'bin', 'apache', 'conf', 'mydevbox.conf')]);
        }, 2000);
      }
      
      refreshMenu();
    }
  });
}

// Setup domains for existing sites
function setupExistingDomains() {
  const websites = detectWebsites();
  const sitesWithoutDomains = websites.filter(site => !site.hasVhost);
  
  if (sitesWithoutDomains.length === 0) {
    dialog.showMessageBox(null, {
      type: 'info',
      title: 'ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜÿßÿ™',
      message: 'ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿßŸÇÿπ ŸÑÿØŸäŸáÿß ÿØŸàŸÖŸäŸÜÿßÿ™ ŸÖÿ≠ŸÑŸäÿ© ÿ®ÿßŸÑŸÅÿπŸÑ!'
    });
    return;
  }
  
  dialog.showMessageBox(null, {
    type: 'question',
    buttons: ['ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÉŸÑ', 'ÿ•ŸÑÿ∫ÿßÿ°'],
    title: 'ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜÿßÿ™',
    message: `ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ•ÿπÿØÿßÿØ ÿØŸàŸÖŸäŸÜÿßÿ™ ŸÖÿ≠ŸÑŸäÿ© ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿßŸÇÿπÿü`,
    detail: `ÿßŸÑŸÖŸàÿßŸÇÿπ: ${sitesWithoutDomains.map(s => s.name + '.test').join(', ')}`
  }).then(async result => {
    if (result.response === 0) {
      let successCount = 0;
      let totalCount = sitesWithoutDomains.length;
      
      for (const site of sitesWithoutDomains) {
        const domain = `${site.name}.test`;
        const vhostCreated = createVirtualHost(site.name, site.path);
        const hostsUpdated = addToHosts(domain);
        
        if (vhostCreated && hostsUpdated) {
          successCount++;
        }
      }
      
      dialog.showMessageBox(null, {
        type: successCount === totalCount ? 'info' : 'warning',
        title: 'ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜÿßÿ™',
        message: `ÿ™ŸÖ ÿ•ÿπÿØÿßÿØ ${successCount} ŸÖŸÜ ${totalCount} ÿØŸàŸÖŸäŸÜ`,
        detail: successCount < totalCount ? 'ÿ®ÿπÿ∂ ÿßŸÑÿØŸàŸÖŸäŸÜÿßÿ™ ŸÑŸÖ Ÿäÿ™ŸÖ ÿ•ÿπÿØÿßÿØŸáÿß - ŸÇÿØ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨ ŸÉŸÖÿØŸäÿ±' : 'ÿ™ŸÖ ÿ•ÿπÿØÿßÿØ ÿ¨ŸÖŸäÿπ ÿßŸÑÿØŸàŸÖŸäŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!'
      });
      
      // Restart Apache to apply changes
      if (isServiceRunning('apache')) {
        stopService('apache');
        setTimeout(() => {
          startService('apache', path.join(baseDir, 'bin', 'apache', 'bin', 'httpd.exe'), ['-f', path.join(baseDir, 'bin', 'apache', 'conf', 'mydevbox.conf')]);
        }, 2000);
      }
      
      refreshMenu();
    }
  });
}

// Ÿàÿ∏ÿßÿ¶ŸÅ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ŸÇÿØŸÖ
function createProgressWindow(title, message) {
  if (progressWindow) {
    progressWindow.close();
  }
  
  downloadStartTime = Date.now();
  
  progressWindow = new BrowserWindow({
    width: 500,
    height: 400,
    resizable: false,
    minimizable: false,
    maximizable: false,
    alwaysOnTop: true,
    autoHideMenuBar: true,
    center: true,
    title: title,
    icon: path.join(baseDir, 'assets', 'icon.png'),
    skipTaskbar: true,  // ÿ•ÿÆŸÅÿßÿ° ŸÖŸÜ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑŸÖŸáÿßŸÖ
    show: false,        // ÿπÿØŸÖ ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ŸÖÿ®ÿßÿ¥ÿ±ÿ©
    frame: true,       // ÿ•ÿ≤ÿßŸÑÿ© ÿ•ÿ∑ÿßÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
    transparent: true,  // ÿ¨ÿπŸÑ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ¥ŸÅÿßŸÅÿ©
    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true
    }
  });
  
  const progressHtml = `
<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 300% 300%;
            animation: gradientShift 8s ease infinite;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            padding: 20px;
            overflow: hidden;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .background-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 2px, transparent 2px),
                radial-gradient(circle at 75% 75%, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 50px 50px, 30px 30px;
            animation: float 20s linear infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-50px); }
        }
        
        .container {
            position: relative;
            background: linear-gradient(145deg, rgba(255,255,255,0.25) 0%, rgba(255,255,255,0.1) 100%);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.5),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            min-width: 480px;
            transform: translateY(0);
            animation: containerPulse 4s ease-in-out infinite;
        }
        
        @keyframes containerPulse {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-5px) scale(1.02); }
        }
        
        .logo-container {
            margin-bottom: 20px;
        }
        
        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
            animation: logoRotate 3s linear infinite;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        
        @keyframes logoRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 25px;
            font-weight: 400;
        }
        
        .message {
            font-size: 16px;
            margin-bottom: 25px;
            opacity: 0.95;
            font-weight: 600;
            background: rgba(255,255,255,0.1);
            padding: 12px 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .progress-container {
            margin: 25px 0;
            position: relative;
        }
        
        .progress-wrapper {
            position: relative;
            margin-bottom: 15px;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b 0%, #4ecdc4 50%, #45b7d1 100%);
            background-size: 200% 100%;
            border-radius: 25px;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
            position: relative;
            animation: progressGlow 2s ease-in-out infinite;
        }
        
        @keyframes progressGlow {
            0%, 100% { 
                box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
                background-position: 0% 50%;
            }
            50% { 
                box-shadow: 0 0 20px rgba(78, 205, 196, 0.8);
                background-position: 100% 50%;
            }
        }
        
        .progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: shimmer 1.5s infinite;
            border-radius: 25px;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-text {
            font-size: 24px;
            font-weight: 700;
            margin: 15px 0;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #fff, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .details {
            font-size: 13px;
            opacity: 0.85;
            white-space: pre-line;
            line-height: 1.6;
            background: rgba(0,0,0,0.1);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            font-weight: 500;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            margin: 20px auto;
            position: relative;
        }
        
        .spinner-ring {
            width: 100%;
            height: 100%;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #4ecdc4;
            border-right: 4px solid #ff6b6b;
            border-radius: 50%;
            animation: spinMultiColor 1.2s linear infinite;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
        }
        
        @keyframes spinMultiColor {
            0% { 
                transform: rotate(0deg);
                border-top-color: #4ecdc4;
                border-right-color: #ff6b6b;
            }
            33% { 
                border-top-color: #45b7d1;
                border-right-color: #4ecdc4;
            }
            66% { 
                border-top-color: #ff6b6b;
                border-right-color: #45b7d1;
            }
            100% { 
                transform: rotate(360deg);
                border-top-color: #4ecdc4;
                border-right-color: #ff6b6b;
            }
        }
        
        .status-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 12px;
            height: 12px;
            background: #4ecdc4;
            border-radius: 50%;
            animation: statusPulse 2s ease-in-out infinite;
            box-shadow: 0 0 15px #4ecdc4;
        }
        
        @keyframes statusPulse {
            0%, 100% { 
                transform: scale(1);
                opacity: 1;
            }
            50% { 
                transform: scale(1.5);
                opacity: 0.7;
            }
        }
        
        .floating-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255,255,255,0.6);
            border-radius: 50%;
            animation: floatUp 8s linear infinite;
        }
        
        .particle:nth-child(1) { left: 10%; animation-delay: 0s; }
        .particle:nth-child(2) { left: 30%; animation-delay: 2s; }
        .particle:nth-child(3) { left: 50%; animation-delay: 4s; }
        .particle:nth-child(4) { left: 70%; animation-delay: 6s; }
        .particle:nth-child(5) { left: 90%; animation-delay: 1s; }
        
        @keyframes floatUp {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
                transform: scale(1);
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(0);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="background-pattern"></div>
    <div class="floating-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>
    
    <div class="container">
        <div class="status-indicator"></div>
        
        <div class="logo-container">
            <div class="logo">üì¶</div>
        </div>
        
        <div class="title">${title}</div>
        <div class="subtitle">MyDevBox - ÿ®Ÿäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸÖÿ≠ŸÑŸäÿ©</div>
        
        <div class="message" id="message">${message}</div>
        
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
        </div>
        
        <div class="progress-container">
            <div class="progress-wrapper">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <div class="progress-text" id="progressText">0%</div>
            <div class="details" id="details">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ÿπÿØÿßÿØ...</div>
        </div>
    </div>
</body>
</html>`;
  
  progressWindow.loadURL(`data:text/html;charset=utf-8,${encodeURIComponent(progressHtml)}`);
  
  // ÿπÿ±ÿ∂ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ®ÿπÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ± fade-in
  progressWindow.once('ready-to-show', () => {
    progressWindow.show();
    progressWindow.setOpacity(0);
    
    // ÿ™ÿ£ÿ´Ÿäÿ± fade-in ÿ™ÿØÿ±Ÿäÿ¨Ÿä
    let opacity = 0;
    const fadeIn = setInterval(() => {
      opacity += 0.1;
      if (opacity >= 1) {
        opacity = 1;
        clearInterval(fadeIn);
      }
      progressWindow.setOpacity(opacity);
    }, 30);
  });
  
  progressWindow.on('closed', () => {
    progressWindow = null;
  });
}

function updateProgressWindow(message, progress, details) {
  if (!progressWindow) return;
  
  progressWindow.webContents.executeJavaScript(`
    document.getElementById('message').textContent = "${message}";
    document.getElementById('progressFill').style.width = "${progress}%";
    document.getElementById('progressText').textContent = "${progress}%";
    document.getElementById('details').textContent = "${details}";
  `);
}

function closeProgressWindow() {
  if (progressWindow) {
    // ÿ™ÿ£ÿ´Ÿäÿ± fade-out ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ
    let opacity = 1;
    const fadeOut = setInterval(() => {
      opacity -= 0.1;
      if (opacity <= 0) {
        opacity = 0;
        clearInterval(fadeOut);
        progressWindow.close();
        progressWindow = null;
      } else {
        progressWindow.setOpacity(opacity);
      }
    }, 30);
  }
}

function calculateDownloadSpeed(downloadedBytes) {
  if (!downloadStartTime) return '0 KB/s';
  
  const elapsed = (Date.now() - downloadStartTime) / 1000; // ÿ®ÿßŸÑÿ´ŸàÿßŸÜŸä
  if (elapsed < 1) return '...';
  
  const speed = downloadedBytes / elapsed; // bytes per second
  
  if (speed < 1024) {
    return `${Math.round(speed)} B/s`;
  } else if (speed < 1024 * 1024) {
    return `${Math.round(speed / 1024)} KB/s`;
  } else {
    return `${(speed / (1024 * 1024)).toFixed(1)} MB/s`;
  }
}

function calculateTimeLeft(downloadedBytes, totalBytes, speedString) {
  if (!downloadStartTime || downloadedBytes === 0) return 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ÿ≥ÿßÿ®...';
  
  const elapsed = (Date.now() - downloadStartTime) / 1000;
  if (elapsed < 2) return 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ÿ≥ÿßÿ®...';
  
  const speed = downloadedBytes / elapsed; // bytes per second
  const remainingBytes = totalBytes - downloadedBytes;
  const timeLeftSeconds = remainingBytes / speed;
  
  if (timeLeftSeconds < 60) {
    return `${Math.round(timeLeftSeconds)} ÿ´ÿßŸÜŸäÿ©`;
  } else if (timeLeftSeconds < 3600) {
    const minutes = Math.round(timeLeftSeconds / 60);
    return `${minutes} ÿØŸÇŸäŸÇÿ©`;
  } else {
    const hours = Math.floor(timeLeftSeconds / 3600);
    const minutes = Math.round((timeLeftSeconds % 3600) / 60);
    return `${hours} ÿ≥ÿßÿπÿ© Ÿà ${minutes} ÿØŸÇŸäŸÇÿ©`;
  }
}

// Ÿàÿ∏ÿßÿ¶ŸÅ phpMyAdmin
function isPhpMyAdminInstalled() {
  const phpMyAdminPath = path.join(baseDir, 'www', 'phpmyadmin');
  return fs.existsSync(phpMyAdminPath) && 
         fs.existsSync(path.join(phpMyAdminPath, 'index.php'));
}

function downloadPhpMyAdmin() {
  const downloadUrl = 'https://files.phpmyadmin.net/phpMyAdmin/5.2.2/phpMyAdmin-5.2.2-all-languages.zip';
  const zipPath = path.join(baseDir, 'tmp', 'phpmyadmin.zip');
  const phpMyAdminPath = path.join(baseDir, 'www', 'phpmyadmin');
  
  // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÖÿ¨ŸÑÿØ tmp
  const tmpDir = path.join(baseDir, 'tmp');
  if (!fs.existsSync(tmpDir)) {
    fs.mkdirSync(tmpDir, { recursive: true });
  }
  
  // ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© HTML ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÇÿØŸÖ
  createProgressWindow('ÿ™ÿ≠ŸÖŸäŸÑ phpMyAdmin', 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ phpMyAdmin ŸÖŸÜ ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿ±ÿ≥ŸÖŸä...');
  
  const file = fs.createWriteStream(zipPath);
  
  https.get(downloadUrl, (response) => {
    if (response.statusCode === 302 || response.statusCode === 301) {
      // ÿ•ÿπÿßÿØÿ© ÿ™Ÿàÿ¨ŸäŸá
      return downloadPhpMyAdminFromUrl(response.headers.location, zipPath, phpMyAdminPath);
    }
    
    const totalSize = parseInt(response.headers['content-length'], 10);
    let downloadedSize = 0;
    const totalSizeMB = (totalSize / 1024 / 1024).toFixed(1);
    
    updateProgressWindow('ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...', 0, `ÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: ${totalSizeMB} ŸÖŸäÿ¨ÿßÿ®ÿßŸäÿ™`);
    
    response.pipe(file);
    
    response.on('data', (chunk) => {
      downloadedSize += chunk.length;
      const progress = Math.round((downloadedSize / totalSize) * 100);
      const downloadedMB = (downloadedSize / 1024 / 1024).toFixed(1);
      const speed = calculateDownloadSpeed(downloadedSize);
      const timeLeft = calculateTimeLeft(downloadedSize, totalSize, speed);
      
      updateProgressWindow(
        `ÿ™ÿ≠ŸÖŸäŸÑ phpMyAdmin... ${progress}%`,
        progress,
        `ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ: ${downloadedMB} ŸÖŸÜ ${totalSizeMB} ŸÖŸäÿ¨ÿßÿ®ÿßŸäÿ™\nÿßŸÑÿ≥ÿ±ÿπÿ©: ${speed}\nÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ${timeLeft}`
      );
    });
    
    file.on('finish', () => {
      file.close();
      updateProgressWindow('ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ! ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨...', 100, 'ÿ¨ÿßÿ±Ÿä ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÖŸÑŸÅÿßÿ™...');
      setTimeout(() => {
        extractPhpMyAdmin(zipPath, phpMyAdminPath);
      }, 1000);
    });
  }).on('error', (err) => {
    fs.unlink(zipPath, () => {}); // ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™
    closeProgressWindow();
    dialog.showErrorBox('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ', `ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ phpMyAdmin:\n${err.message}`);
  });
}

function downloadPhpMyAdminFromUrl(url, zipPath, phpMyAdminPath) {
  const file = fs.createWriteStream(zipPath);
  
  https.get(url, (response) => {
    const totalSize = parseInt(response.headers['content-length'], 10);
    let downloadedSize = 0;
    const totalSizeMB = (totalSize / 1024 / 1024).toFixed(1);
    
    updateProgressWindow('ÿ•ÿπÿßÿØÿ© ÿ™Ÿàÿ¨ŸäŸá... ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ', 0, `ÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: ${totalSizeMB} ŸÖŸäÿ¨ÿßÿ®ÿßŸäÿ™`);
    
    response.pipe(file);
    
    response.on('data', (chunk) => {
      downloadedSize += chunk.length;
      const progress = Math.round((downloadedSize / totalSize) * 100);
      const downloadedMB = (downloadedSize / 1024 / 1024).toFixed(1);
      const speed = calculateDownloadSpeed(downloadedSize);
      const timeLeft = calculateTimeLeft(downloadedSize, totalSize, speed);
      
      updateProgressWindow(
        `ÿ™ÿ≠ŸÖŸäŸÑ phpMyAdmin... ${progress}%`,
        progress,
        `ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ: ${downloadedMB} ŸÖŸÜ ${totalSizeMB} ŸÖŸäÿ¨ÿßÿ®ÿßŸäÿ™\nÿßŸÑÿ≥ÿ±ÿπÿ©: ${speed}\nÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ${timeLeft}`
      );
    });
    
    file.on('finish', () => {
      file.close();
      updateProgressWindow('ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ! ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨...', 100, 'ÿ¨ÿßÿ±Ÿä ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÖŸÑŸÅÿßÿ™...');
      setTimeout(() => {
        extractPhpMyAdmin(zipPath, phpMyAdminPath);
      }, 1000);
    });
  }).on('error', (err) => {
    fs.unlink(zipPath, () => {}); // ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™
    closeProgressWindow();
    dialog.showErrorBox('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ', `ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ phpMyAdmin:\n${err.message}`);
  });
}

async function extractPhpMyAdmin(zipPath, phpMyAdminPath) {
  try {
    // ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¨ŸÑÿØ www ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸã
    const wwwPath = path.join(baseDir, 'www');
    if (!fs.existsSync(wwwPath)) {
      fs.mkdirSync(wwwPath, { recursive: true });
    }
    
    updateProgressWindow('ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨...', 100, 'ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ŸÖŸÑŸÅÿßÿ™ phpMyAdmin...');
    
    // ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑
    await extract(zipPath, { dir: wwwPath });
    
    updateProgressWindow('ÿ™ŸÜÿ∏ŸäŸÖ ÿßŸÑŸÖŸÑŸÅÿßÿ™...', 100, 'ÿ•ÿπÿØÿßÿØ ŸÖÿ¨ŸÑÿØ phpMyAdmin...');
    
    // ÿ•ÿπÿßÿØÿ© ÿ™ÿ≥ŸÖŸäÿ© ÿßŸÑŸÖÿ¨ŸÑÿØ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨
    const extractedDirs = fs.readdirSync(wwwPath)
      .filter(item => item.startsWith('phpMyAdmin-') && 
                     fs.statSync(path.join(wwwPath, item)).isDirectory());
    
    if (extractedDirs.length > 0) {
      const extractedPath = path.join(wwwPath, extractedDirs[0]);
      
      // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ¨ŸÑÿØ phpmyadmin ŸÖŸàÿ¨ŸàÿØÿå ÿßÿ≠ÿ∞ŸÅŸá ÿ£ŸàŸÑÿßŸã
      if (fs.existsSync(phpMyAdminPath)) {
        fs.rmSync(phpMyAdminPath, { recursive: true, force: true });
      }
      
      // ÿ•ÿπÿßÿØÿ© ÿ™ÿ≥ŸÖŸäÿ© ÿßŸÑŸÖÿ¨ŸÑÿØ
      fs.renameSync(extractedPath, phpMyAdminPath);
      
      updateProgressWindow('ÿßŸÑÿ™ŸÉŸàŸäŸÜ ÿßŸÑŸÜŸáÿßÿ¶Ÿä...', 100, 'ÿ•ÿπÿØÿßÿØ ŸÖŸÑŸÅÿßÿ™ ÿßŸÑÿ™ŸÉŸàŸäŸÜ...');
      
      // ÿ™ŸÉŸàŸäŸÜ phpMyAdmin
      configurePhpMyAdmin(phpMyAdminPath);
      
      // ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑
      fs.unlink(zipPath, () => {});
      
      // ÿ•ÿ∫ŸÑÿßŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ŸÇÿØŸÖ
      closeProgressWindow();
      
      dialog.showMessageBox(null, {
        type: 'info',
        title: 'ÿ™ŸÖ ÿßŸÑÿ™ÿ±ŸÉŸäÿ® ÿ®ŸÜÿ¨ÿßÿ≠',
        message: 'ÿ™ŸÖ ÿ™ÿ±ŸÉŸäÿ® phpMyAdmin ÿ®ŸÜÿ¨ÿßÿ≠! üéâ',
        detail: 'ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸäŸá ÿπÿ®ÿ±: http://localhost/phpmyadmin',
        buttons: ['ŸÖŸàÿßŸÅŸÇ', 'ŸÅÿ™ÿ≠ phpMyAdmin']
      }).then((result) => {
        if (result.response === 1) {
          shell.openExternal('http://localhost/phpmyadmin');
        }
        refreshMenu();
      });
    } else {
      throw new Error('ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖÿ¨ŸÑÿØ phpMyAdmin ÿßŸÑŸÖÿ≥ÿ™ÿÆÿ±ÿ¨');
    }
  } catch (error) {
    closeProgressWindow();
    dialog.showErrorBox('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨', `ŸÅÿ¥ŸÑ ŸÅŸä ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ phpMyAdmin:\n${error.message}`);
  }
}

function configurePhpMyAdmin(phpMyAdminPath) {
  const configPath = path.join(phpMyAdminPath, 'config.inc.php');
  
  const config = `<?php
declare(strict_types=1);

/**
 * This is needed for cookie based authentication to encrypt password in
 * cookie. Needs to be 32 chars long.
 */
$cfg['blowfish_secret'] = '${generateRandomString(32)}';

/**
 * Servers configuration
 */
$i = 0;

/**
 * First server
 */
$i++;
/* Authentication type */
$cfg['Servers'][$i]['auth_type'] = 'cookie';
/* Server parameters */
$cfg['Servers'][$i]['host'] = 'localhost';
$cfg['Servers'][$i]['port'] = 3306;
$cfg['Servers'][$i]['compress'] = false;
$cfg['Servers'][$i]['AllowNoPassword'] = true;

/**
 * phpMyAdmin configuration storage settings.
 */

/* User used to manipulate with storage */
// $cfg['Servers'][$i]['controlhost'] = '';
// $cfg['Servers'][$i]['controlport'] = '';
// $cfg['Servers'][$i]['controluser'] = 'pma';
// $cfg['Servers'][$i]['controlpass'] = 'pmapass';

/**
 * Directories for saving/loading files from server
 */
$cfg['UploadDir'] = '';
$cfg['SaveDir'] = '';

/**
 * Whether to display icons or text or both icons and text in table row
 * action segment. Value can be either of 'icons', 'text' or 'both'.
 * default = 'both'
 */
//$cfg['RowActionType'] = 'icons';

/**
 * Defines whether a user should be displayed a "show all (records)"
 * button in browse mode or not.
 * default = false
 */
//$cfg['ShowAll'] = true;

/**
 * Number of rows displayed when browsing a result set. If the result
 * set contains more rows, "Previous" and "Next".
 * Possible values: 25, 50, 100, 250, 500
 * default = 25
 */
//$cfg['MaxRows'] = 50;

/**
 * Disallow editing of binary fields
 * valid values are:
 *   false    allow editing
 *   'blob'   allow editing except for BLOB fields
 *   'noblob' disallow editing except for BLOB fields
 *   'all'    disallow editing
 * default = 'blob'
 */
//$cfg['ProtectBinary'] = false;

/**
 * Default language to use, if not browser-defined or user-defined
 * (you find all languages in the locale folder)
 * uncomment the desired line:
 * default = 'en'
 */
$cfg['DefaultLang'] = 'ar';

/**
 * How many columns should be used for table display of a database?
 * (a value larger than 1 results in some information being hidden)
 * default = 1
 */
//$cfg['PropertiesNumColumns'] = 2;

/**
 * Set to true if you want DB-based query history.If false, this utilizes
 * JS-routines to display query history (lost by window close)
 *
 * This requires configuration storage enabled, see above.
 * default = false
 */
//$cfg['QueryHistoryDB'] = true;

/**
 * When using DB-based query history, how many entries should be kept?
 * default = 25
 */
//$cfg['QueryHistoryMax'] = 100;

/**
 * Whether or not to query the user before sending the error report to
 * the phpMyAdmin team when a JavaScript error occurs
 *
 * Available options
 * ('ask' | 'always' | 'never')
 * default = 'ask'
 */
//$cfg['SendErrorReports'] = 'always';

/**
 * 'URLQueryEncryption' defines whether phpMyAdmin will encrypt sensitive data from the URL query string.
 * 'URLQueryEncryptionSecretKey' is a 32 bytes long secret key used to encrypt/decrypt the URL query string.
 */
//$cfg['URLQueryEncryption'] = true;
//$cfg['URLQueryEncryptionSecretKey'] = '';

/**
 * You can find more configuration options in the documentation
 * in the doc/ folder or at <https://docs.phpmyadmin.net/>.
 */
`;

  fs.writeFileSync(configPath, config);
  console.log('phpMyAdmin configured successfully');
}

function generateRandomString(length) {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  let result = '';
  for (let i = 0; i < length; i++) {
    result += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return result;
}

async function startApache() {
  const configPath = path.join(baseDir, 'config', 'httpd.conf');
  const apachePath = path.join(baseDir, 'bin', 'apache', 'bin', 'httpd.exe');
  
  if (!fs.existsSync(apachePath)) {
    showNotification('Apache Error', 'Apache not found in specified path');
    return;
  }
  
  if (!fs.existsSync(configPath)) {
    showNotification('Apache Config Error', 'httpd.conf file not found');
    return;
  }
  
  // Test configuration first
  const testCmd = `"${apachePath}" -f "${configPath}" -t`;
  exec(testCmd, async (testError, testStdout, testStderr) => {
    if (testError) {
      console.log('Apache config test failed:', testError.message);
      showNotification('Apache Config Error', testError.message);
      return;
    }
    
    console.log('üîÑ Stopping any existing Apache processes...');
    
    // Stop any existing Apache processes with enhanced killing
    await killExistingApacheProcesses();
    
    // Wait a moment then start Apache
    setTimeout(() => {
      const startApacheCmd = `"${apachePath}" -f "${configPath}"`;
      const child = exec(startApacheCmd, (error, stdout, stderr) => {
        if (error) {
          console.log('Apache start error:', error.message);
          showNotification('Apache Start Error', error.message);
        }
      });
      
      // Check if Apache started successfully after a short delay
      setTimeout(() => {
        exec('netstat -an | findstr ":80"', (netError, netStdout) => {
          if (netStdout && netStdout.includes(':80')) {
            console.log('‚úÖ Apache started successfully');
            showNotification('Apache Started', 'Apache is now running on http://localhost');
          } else {
            console.log('‚ö†Ô∏è Apache may not have started properly');
            showNotification('Apache Warning', 'Apache may not have started - check logs');
          }
        });
      }, 2000);
    }, 2000); // ÿ≤ŸäÿßÿØÿ© ŸàŸÇÿ™ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±
  });
}

function openPhpMyAdmin() {
  if (!isPhpMyAdminInstalled()) {
    dialog.showMessageBox(null, {
      type: 'question',
      title: 'phpMyAdmin ÿ∫Ÿäÿ± ŸÖÿ´ÿ®ÿ™',
      message: 'phpMyAdmin ÿ∫Ÿäÿ± ŸÖÿ´ÿ®ÿ™. ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ≠ŸÖŸäŸÑŸá Ÿàÿ™ÿ´ÿ®Ÿäÿ™Ÿá ÿßŸÑÿ¢ŸÜÿü',
      buttons: ['ŸÜÿπŸÖ', 'ŸÑÿß'],
      defaultId: 0
    }).then((result) => {
      if (result.response === 0) {
        downloadPhpMyAdmin();
      }
    });
    return;
  }
  
  if (!isServiceRunning('apache')) {
    dialog.showMessageBox(null, {
      type: 'warning',
      title: 'Apache ÿ∫Ÿäÿ± ŸÖÿ¥ÿ∫ŸÑ',
      message: 'Ÿäÿ¨ÿ® ÿ™ÿ¥ÿ∫ŸäŸÑ Apache ÿ£ŸàŸÑÿßŸã ŸÑŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ phpMyAdmin.',
      buttons: ['ÿ™ÿ¥ÿ∫ŸäŸÑ Apache', 'ÿ•ŸÑÿ∫ÿßÿ°']
    }).then(async (result) => {
      if (result.response === 0) {
        const portAvailable = await isPortAvailable(80);
        if (!portAvailable) {
          dialog.showErrorBox('ÿÆÿ∑ÿ£', 'ÿßŸÑŸÖŸÜŸÅÿ∞ 80 ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿßŸÑŸÅÿπŸÑ! Ÿäÿ±ÿ¨Ÿâ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿÆÿØŸÖÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ≥ÿ™ÿÆÿØŸÖŸá ÿ£Ÿà ÿ™ÿ∫ŸäŸäÿ± ŸÖŸÜŸÅÿ∞ Apache.');
          return;
        }
        startApache();
        setTimeout(() => {
          shell.openExternal('http://localhost/phpmyadmin');
        }, 2000);
      }
    });
    return;
  }
  
  shell.openExternal('http://localhost/phpmyadmin');
}

function removePhpMyAdmin() {
  if (!isPhpMyAdminInstalled()) {
    dialog.showMessageBox(null, {
      type: 'info',
      title: 'phpMyAdmin',
      message: 'phpMyAdmin ÿ∫Ÿäÿ± ŸÖÿ´ÿ®ÿ™.',
      buttons: ['ŸÖŸàÿßŸÅŸÇ']
    });
    return;
  }
  
  dialog.showMessageBox(null, {
    type: 'question',
    title: 'ÿ≠ÿ∞ŸÅ phpMyAdmin',
    message: 'ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ phpMyAdminÿü',
    detail: 'ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ŸÖŸÑŸÅÿßÿ™ phpMyAdmin ÿ®ÿ¥ŸÉŸÑ ÿØÿßÿ¶ŸÖ.',
    buttons: ['ŸÜÿπŸÖÿå ÿßÿ≠ÿ∞ŸÅ', 'ÿ•ŸÑÿ∫ÿßÿ°'],
    defaultId: 1
  }).then((result) => {
    if (result.response === 0) {
      try {
        const phpMyAdminPath = path.join(baseDir, 'www', 'phpmyadmin');
        fs.rmSync(phpMyAdminPath, { recursive: true, force: true });
        
        dialog.showMessageBox(null, {
          type: 'info',
          title: 'ÿ™ŸÖ ÿßŸÑÿ≠ÿ∞ŸÅ',
          message: 'ÿ™ŸÖ ÿ≠ÿ∞ŸÅ phpMyAdmin ÿ®ŸÜÿ¨ÿßÿ≠.',
          buttons: ['ŸÖŸàÿßŸÅŸÇ']
        });
        
        refreshMenu();
      } catch (error) {
        dialog.showErrorBox('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ÿ∞ŸÅ', `ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ phpMyAdmin:\n${error.message}`);
      }
    }
  });
}

// Build and set the tray context menu dynamically
function refreshMenu() {
  const tray = global.appTray;
  if (!tray) return;
  const apacheRunning = isServiceRunning('apache');
  const mysqlRunning = isServiceRunning('mysql');
  const phpVersions = detectPHPVersions();
  const websites = detectWebsites();
  
  // Update tray icon tooltip with status
  const statusText = `MyDevBox\nApache: ${apacheRunning ? 'üü¢ ŸäÿπŸÖŸÑ' : 'üî¥ ŸÖÿ™ŸàŸÇŸÅ'}\nMySQL: ${mysqlRunning ? 'üü¢ ŸäÿπŸÖŸÑ' : 'üî¥ ŸÖÿ™ŸàŸÇŸÅ'}`;
  tray.setToolTip(statusText);

  const menu = Menu.buildFromTemplate([
    // Apache Section
    { 
      label: `Apache ${apacheRunning ? 'üü¢ (ŸäÿπŸÖŸÑ)' : 'üî¥ (ŸÖÿ™ŸàŸÇŸÅ)'}`, 
      enabled: false 
    },
    { 
      label: apacheRunning ? 'ÿ•ŸäŸÇÿßŸÅ Apache' : 'ÿ™ÿ¥ÿ∫ŸäŸÑ Apache', 
      click: apacheRunning ? 
        () => stopService('apache') : 
        async () => {
          const portAvailable = await isPortAvailable(80);
          if (!portAvailable) {
            dialog.showErrorBox('ÿÆÿ∑ÿ£', 'ÿßŸÑŸÖŸÜŸÅÿ∞ 80 ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿßŸÑŸÅÿπŸÑ! Ÿäÿ±ÿ¨Ÿâ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿÆÿØŸÖÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ≥ÿ™ÿÆÿØŸÖŸá ÿ£Ÿà ÿ™ÿ∫ŸäŸäÿ± ŸÖŸÜŸÅÿ∞ Apache.');
            return;
          }
          const configPath = path.join(baseDir, 'config', 'httpd.conf');
          const apachePath = path.join(baseDir, 'bin', 'apache', 'bin', 'httpd.exe');
          
          if (fs.existsSync(apachePath)) {
            // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿ∑ŸÑŸÇ ŸÑŸÖŸÑŸÅ ÿßŸÑÿ™ŸÉŸàŸäŸÜ
            startService('apache', apachePath, ['-f', configPath]);
          } else {
            showNotification('ÿÆÿ∑ÿ£ ŸÅŸä Apache', 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ Apache ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿ≠ÿØÿØ');
          }
        }
    },
    { label: 'ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä', enabled: apacheRunning, click: () => shell.openExternal('http://localhost') },
    
    // Websites submenu
    ...(websites.length > 0 ? [{
      label: 'ÿßŸÑŸÖŸàÿßŸÇÿπ ÿßŸÑŸÖÿ≠ŸÑŸäÿ©',
      enabled: apacheRunning,
      submenu: websites.map(site => ({
        label: `üìÅ ${site.name} ${site.hasVhost ? 'üåê' : 'üìÇ'}`,
        submenu: [
          ...(site.hasVhost ? [
            { label: `ŸÅÿ™ÿ≠ ${site.domain}`, click: () => {
              if (site.domainUrl) {
                shell.openExternal(site.domainUrl);
              } else {
                console.error('Domain URL is undefined for site:', site.name);
              }
            }},
            { type: 'separator' }
          ] : []),
          { label: 'ŸÅÿ™ÿ≠ localhost', click: () => {
            if (site.url) {
              shell.openExternal(site.url);
            } else {
              console.error('URL is undefined for site:', site.name);
            }
          }},
          { label: 'ŸÅÿ™ÿ≠ ÿßŸÑŸÖÿ¨ŸÑÿØ', click: () => shell.openPath(site.path) },
          { type: 'separator' },
          ...(site.hasVhost ? [
            { label: 'ÿ≠ÿ∞ŸÅ ÿßŸÑÿØŸàŸÖŸäŸÜ', click: () => removeSiteDomain(site.name) }
          ] : [
            { label: 'ÿ•ŸÜÿ¥ÿßÿ° ÿØŸàŸÖŸäŸÜ ŸÖÿ≠ŸÑŸä', click: () => createSiteDomain(site.name, site.path) }
          ])
        ]
      }))
    }] : []),
    
    { label: 'ÿßÿÆÿ™ÿ®ÿßÿ± ÿ™ŸÉŸàŸäŸÜ Apache', click: () => {
      const configPath = path.join(baseDir, 'config', 'httpd.conf');
      const apachePath = path.join(baseDir, 'bin', 'apache', 'bin', 'httpd.exe');
      
      if (!fs.existsSync(apachePath)) {
        dialog.showErrorBox('ÿÆÿ∑ÿ£', 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ Apache ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿ≠ÿØÿØ');
        return;
      }
      
      // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿ∑ŸÑŸÇ ŸÑŸÖŸÑŸÅ ÿßŸÑÿ™ŸÉŸàŸäŸÜ
      const proc = spawn(apachePath, ['-t', '-f', configPath], {
        stdio: ['ignore', 'pipe', 'pipe']
      });
      
      let output = '';
      proc.stdout.on('data', (data) => output += data.toString());
      proc.stderr.on('data', (data) => output += data.toString());
      
      proc.on('close', (code) => {
        dialog.showMessageBox(null, {
          type: code === 0 ? 'info' : 'error',
          title: 'ÿßÿÆÿ™ÿ®ÿßÿ± ÿ™ŸÉŸàŸäŸÜ Apache',
          message: code === 0 ? 'ÿ™ŸÉŸàŸäŸÜ Apache ÿµÿ≠Ÿäÿ≠ ‚úÖ' : `ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ŸÉŸàŸäŸÜ:\n${output}`
        });
      });
    }},
    { type: 'separator' },
    // MySQL Section
    { 
      label: `MySQL ${mysqlRunning ? 'üü¢ (ŸäÿπŸÖŸÑ)' : 'üî¥ (ŸÖÿ™ŸàŸÇŸÅ)'}`, 
      enabled: false 
    },
    { 
      label: mysqlRunning ? 'ÿ•ŸäŸÇÿßŸÅ MySQL' : 'ÿ™ÿ¥ÿ∫ŸäŸÑ MySQL', 
      click: mysqlRunning ? 
        () => stopService('mysql') :
        async () => {
          try {
            // Generate MySQL configuration first
            generateMySQLConfig();
            
            // Check if port 3306 is available
            const portAvailable = await isPortAvailable(3306);
            if (!portAvailable) {
              dialog.showErrorBox('ÿÆÿ∑ÿ£', 'ÿßŸÑŸÖŸÜŸÅÿ∞ 3306 ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿßŸÑŸÅÿπŸÑ! Ÿäÿ±ÿ¨Ÿâ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿÆÿØŸÖÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ≥ÿ™ÿÆÿØŸÖŸá ÿ£Ÿà ÿ™ÿ∫ŸäŸäÿ± ŸÖŸÜŸÅÿ∞ MySQL.');
              return;
            }
            
            // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ MySQL
            const mysqlPath = path.join(baseDir, 'bin', 'mysql', 'bin', 'mysqld.exe');
            if (!fs.existsSync(mysqlPath)) {
              dialog.showErrorBox('ÿÆÿ∑ÿ£ ŸÅŸä MySQL', 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ MySQL ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿ≠ÿØÿØ');
              return;
            }
            
            // ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¨ŸÑÿØ tmp ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸã
            const tmpDir = path.join(baseDir, 'tmp');
            if (!fs.existsSync(tmpDir)) {
              fs.mkdirSync(tmpDir, { recursive: true });
            }
            
            // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿ∑ŸÑŸÇ ŸÑŸÖŸÑŸÅ ÿßŸÑÿ™ŸÉŸàŸäŸÜ
            const configPath = path.join(baseDir, 'config', 'my.ini');
            
            startService('mysql', mysqlPath, [
              '--defaults-file=' + configPath,
              '--console'
            ]);
          } catch (error) {
            dialog.showErrorBox('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ MySQL', error.message);
          }
        }
    },
    // phpMyAdmin section
    ...(isPhpMyAdminInstalled() ? [
      { label: 'üîß ŸÅÿ™ÿ≠ phpMyAdmin', enabled: mysqlRunning && apacheRunning, click: openPhpMyAdmin },
      { label: 'üóëÔ∏è ÿ≠ÿ∞ŸÅ phpMyAdmin', click: removePhpMyAdmin }
    ] : [
      { label: '‚¨áÔ∏è ÿ™ÿ≠ŸÖŸäŸÑ Ÿàÿ™ÿ´ÿ®Ÿäÿ™ phpMyAdmin', click: downloadPhpMyAdmin }
    ]),
    { label: 'ÿßÿÆÿ™ÿ®ÿßÿ± ÿ™ŸÉŸàŸäŸÜ MySQL', click: testMySQLConfig },
    { type: 'separator' },
    {
      label: 'PHP Version',
      submenu: phpVersions.map(v => ({
        label: v.name,
        type: 'radio',
        checked: v.name === 'php-8.4.8',
        click: () => {
          // Update PHP path in mydevbox.conf
          const confPath = path.join(baseDir, 'bin', 'apache', 'conf', 'mydevbox.conf');
          
          // Simple PHP path replacement - you could make this more sophisticated
          dialog.showMessageBox(null, {
            type: 'info',
            title: 'ÿ™ÿ∫ŸäŸäÿ± ÿ•ÿµÿØÿßÿ± PHP',
            message: 'ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿ•ÿµÿØÿßÿ± PHP ÿßŸÑÿ¨ÿØŸäÿØ',
            detail: 'ÿ≥ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ Apache ŸäÿØŸàŸäÿßŸã ŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±'
          });
        }
      }))
    },
    { type: 'separator' },
    { label: 'üìù ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ ÿ≥ÿ±Ÿäÿπ', 
      submenu: [
        { label: 'üìÑ ŸÖŸàŸÇÿπ HTML ÿ®ÿ≥Ÿäÿ∑', click: () => createSimpleWebsite() },
        { label: 'üîó ŸÖŸàŸÇÿπ PHP', click: () => createPHPWebsite() },
        { label: 'üóÉÔ∏è ŸÖŸàŸÇÿπ PHP + ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™', click: () => createDatabaseWebsite() }
      ]
    },
    { label: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ ÿ¨ÿØŸäÿØ (ŸÖÿ™ŸÇÿØŸÖ)', click: createNewSite },
    { label: '‚ö° ÿ™ÿ´ÿ®Ÿäÿ™ ÿ≥ÿ±Ÿäÿπ ŸÑŸÑÿ®ÿ±ÿßŸÖÿ¨', 
      submenu: [
        { label: 'üî∂ Laravel', click: () => quickInstall('laravel') },
        { label: 'üü¶ WordPress', click: () => quickInstall('wordpress') },
        { label: 'üî• CodeIgniter', click: () => quickInstall('codeigniter') },
        { label: 'üéº Symfony', click: () => quickInstall('symfony') },
        { label: 'üç∞ CakePHP', click: () => quickInstall('cakephp') },
        { label: '‚ö° Express.js', click: () => quickInstall('express') },
        { label: 'üì± Vue.js', click: () => quickInstall('vue') },
        { label: '‚öõÔ∏è React', click: () => quickInstall('react') }
      ]
    },
    { label: 'ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜÿßÿ™ ŸÑŸÑŸÖŸàÿßŸÇÿπ ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ©', click: setupExistingDomains },
    {
      label: 'ÿ£ÿØŸàÿßÿ™ ÿ•ÿπÿØÿßÿØ Hosts',
      submenu: [
        {
          label: 'PowerShell Script (ŸÖÿ≥ÿ™ÿ≠ÿ≥ŸÜ)',
          click: () => {
            const psPath = path.join(baseDir, 'bin', 'setup-hosts.ps1');
            spawn('powershell', ['-ExecutionPolicy', 'Bypass', '-File', psPath], { 
              detached: true,
              stdio: 'ignore'
            });
          }
        },
        {
          label: 'Batch Script',
          click: () => {
            const batPath = path.join(baseDir, 'bin', 'setup-hosts.bat');
            spawn('powershell', ['-Command', `Start-Process -FilePath "${batPath}" -Verb RunAs`], { 
              detached: true,
              stdio: 'ignore'
            });
          }
        },
        { type: 'separator' },
        {
          label: 'ŸÅÿ™ÿ≠ ŸÖŸÑŸÅ Hosts ŸÑŸÑÿ™ÿ≠ÿ±Ÿäÿ±',
          click: () => {
            const hostsPath = getHostsFilePath();
            spawn('powershell', ['-Command', `Start-Process -FilePath "notepad" -ArgumentList "${hostsPath}" -Verb RunAs`], { 
              detached: true,
              stdio: 'ignore'
            });
          }
        },
        { type: 'separator' },
        {
          label: 'ÿπÿ±ÿ∂ ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØ ÿßŸÑŸäÿØŸàŸä',
          click: () => {
            const instructionsPath = path.join(baseDir, 'bin', 'domains-setup-instructions.txt');
            shell.openPath(instructionsPath);
          }
        }
      ]
    },
    { label: 'ŸÅÿ™ÿ≠ ŸÖÿ¨ŸÑÿØ www', click: () => shell.openPath(path.join(baseDir, 'www')) },
    { label: 'ŸÅÿ™ÿ≠ ŸÖÿ¨ŸÑÿØ ÿßŸÑÿ™ŸÉŸàŸäŸÜ', click: () => shell.openPath(path.join(baseDir, 'config')) },
    { type: 'separator' },
    { label: '‚öôÔ∏è ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™', click: () => {
      try {
        const mainModule = require('./main');
        mainModule.createSettingsWindow();
      } catch (error) {
        console.error('Error opening settings:', error);
      }
    }},
    { type: 'separator' },
    { label: 'üö™ ÿÆÿ±Ÿàÿ¨', click: () => {
      dialog.showMessageBox(null, {
        type: 'question',
        buttons: ['ÿÆÿ±Ÿàÿ¨', 'ÿ•ŸÑÿ∫ÿßÿ°'],
        title: 'ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿÆÿ±Ÿàÿ¨',
        message: 'ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ•ÿ∫ŸÑÿßŸÇ MyDevBoxÿü',
        detail: 'ÿ≥Ÿäÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿÆÿØŸÖÿßÿ™ ÿßŸÑŸÖÿ¥ÿ∫ŸÑÿ©.'
      }).then(result => {
        if (result.response === 0) {
          stopService('apache');
          stopService('mysql');
          setTimeout(() => process.exit(0), 1000);
        }
      });
    }}
  ]);

  tray.setContextMenu(menu);
}

// ÿØŸàÿßŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàÿßŸÇÿπ ÿßŸÑÿ≥ÿ±Ÿäÿπÿ©
async function createSimpleWebsite() {
  try {
    const projectName = await getProjectName('HTML Site');
    if (!projectName) {
      console.log('Website creation cancelled');
      return;
    }

    const projectPath = path.join(baseDir, 'www', projectName);
    const domain = `${projectName}.test`;

    // ŸÅÿ≠ÿµ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖÿ¨ŸÑÿØ ŸÖŸàÿ¨ŸàÿØ
    if (fs.existsSync(projectPath)) {
      const result = await dialog.showMessageBox(null, {
        type: 'question',
        title: 'ÿßŸÑŸÖÿ¨ŸÑÿØ ŸÖŸàÿ¨ŸàÿØ',
        message: `ÿßŸÑŸÖÿ¨ŸÑÿØ ${projectName} ŸÖŸàÿ¨ŸàÿØ ÿ®ÿßŸÑŸÅÿπŸÑ. ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©ÿü`,
        buttons: ['ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©', 'ÿ•ŸÑÿ∫ÿßÿ°'],
        defaultId: 1
      });
      
      if (result.response === 1) return;
    }

    // ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ŸÇÿØŸÖ
    createProgressWindow('ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ HTML', 'ÿ¨ÿßÿ±Ÿä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ...');

    // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ¨ŸÑÿØ
    updateProgressWindow('ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¨ŸÑÿØ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ...', 20, 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¨ŸÑÿØ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ');
    if (!fs.existsSync(projectPath)) {
      fs.mkdirSync(projectPath, { recursive: true });
    }

    // ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ index.html
    updateProgressWindow('ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖŸàŸÇÿπ...', 40, 'ÿ•ŸÜÿ¥ÿßÿ° index.html');
    const htmlContent = `<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${projectName} - ŸÖŸàŸÇÿπŸä ÿßŸÑÿ¨ÿØŸäÿØ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 600px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 2.5em;
        }
        
        p {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .feature {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .info {
            margin-top: 30px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 10px;
            font-size: 0.9em;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéâ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ${projectName}</h1>
        <p>ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπŸÉ ÿ®ŸÜÿ¨ÿßÿ≠! ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿßŸÑÿ®ÿØÿ° ŸÅŸä ÿ™ÿ∑ŸàŸäÿ± ŸÖŸàŸÇÿπŸÉ.</p>
        
        <div class="feature">
            <h3>‚ú® ŸÖŸäÿ≤ÿßÿ™ ÿ¨ÿßŸáÿ≤ÿ©</h3>
            <p>‚Ä¢ ÿ™ÿµŸÖŸäŸÖ ÿ≠ÿØŸäÿ´ ŸàŸÖÿ™ÿ¨ÿßŸàÿ®<br>
            ‚Ä¢ ÿØÿπŸÖ ÿßŸÑÿßÿ™ÿ¨ÿßŸá ÿßŸÑÿπÿ±ÿ®Ÿä<br>
            ‚Ä¢ ÿ™ŸáŸäÿ¶ÿ© ÿ¥ÿßŸÖŸÑÿ© ŸÑŸÑÿ®ÿØÿßŸäÿ©</p>
        </div>
        
        <a href="about.html" class="btn">ÿ™ÿπÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑŸÖÿ≤ŸäÿØ</a>
        
        <div class="info">
            <strong>ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸàŸÇÿπ:</strong><br>
            üìÅ ÿßŸÑŸÖÿ¨ŸÑÿØ: ${projectPath}<br>
            üåê ÿßŸÑÿ±ÿßÿ®ÿ∑: http://${domain}<br>
            üìù ÿßÿ®ÿØÿ£ ÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿ®ÿ™ÿπÿØŸäŸÑ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÑŸÅ
        </div>
    </div>
</body>
</html>`;

    fs.writeFileSync(path.join(projectPath, 'index.html'), htmlContent, 'utf8');

    // ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ about.html
    const aboutContent = `<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿ≠ŸàŸÑ ${projectName}</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 600px;
        }
        
        h1 { color: #333; margin-bottom: 20px; }
        p { color: #666; line-height: 1.6; margin-bottom: 20px; }
        
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã ÿ≠ŸàŸÑ ${projectName}</h1>
        <p>Ÿáÿ∞ÿß ŸÖŸàŸÇÿπ HTML ÿ®ÿ≥Ÿäÿ∑ ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ§Ÿá ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ MyDevBox.</p>
        <p>ŸäŸÖŸÉŸÜŸÉ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ ŸàÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿ≠ÿ≥ÿ® ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ŸÉ.</p>
        <a href="index.html" class="btn">ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</a>
    </div>
</body>
</html>`;

    fs.writeFileSync(path.join(projectPath, 'about.html'), aboutContent, 'utf8');

    // ÿ•ŸÜÿ¥ÿßÿ° Virtual Host
    updateProgressWindow('ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä...', 60, 'ÿ•ŸÜÿ¥ÿßÿ° Virtual Host');
    addVirtualHost(projectName, 'html');

    // ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ hosts file
    updateProgressWindow('ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿØŸàŸÖŸäŸÜ ÿ•ŸÑŸâ hosts...', 80, 'ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑŸÅ hosts');
    try {
      addToHosts(domain);
    } catch (error) {
      console.warn('Failed to add to hosts file:', error.message);
    }

    // ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿπŸÖŸÑŸäÿ©
    updateProgressWindow('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ ÿ®ŸÜÿ¨ÿßÿ≠!', 100, 'ÿ¨ÿßÿ±Ÿä ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàŸÇÿπ...');

    setTimeout(() => {
      closeProgressWindow();
      
      // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÜÿ¨ÿßÿ≠
      dialog.showMessageBox(null, {
        type: 'info',
        title: 'ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ ÿ®ŸÜÿ¨ÿßÿ≠!',
        message: `ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ HTML ÿ®ŸÜÿ¨ÿßÿ≠!`,
        detail: `ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàŸÇÿπ: ${projectName}\nÿßŸÑŸÖÿ¨ŸÑÿØ: ${projectPath}\nÿßŸÑÿ±ÿßÿ®ÿ∑: http://${domain}`,
        buttons: ['ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàŸÇÿπ', 'ŸÅÿ™ÿ≠ ÿßŸÑŸÖÿ¨ŸÑÿØ', 'ŸÖŸàÿßŸÅŸÇ']
      }).then((result) => {
        if (result.response === 0) {
          shell.openExternal(`http://${domain}`);
        } else if (result.response === 1) {
          shell.openPath(projectPath);
        }
      });
      
      refreshMenu();
      showNotification('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ', `ŸÖŸàŸÇÿπ ${projectName} ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ!`);
      
    }, 1000);

  } catch (error) {
    closeProgressWindow();
    dialog.showErrorBox('ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ', error.message);
  }
}

async function createPHPWebsite() {
  try {
    const projectName = await getProjectName('PHP Site');
    if (!projectName) return;

    const projectPath = path.join(baseDir, 'www', projectName);
    const domain = `${projectName}.test`;

    // ŸÅÿ≠ÿµ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖÿ¨ŸÑÿØ ŸÖŸàÿ¨ŸàÿØ
    if (fs.existsSync(projectPath)) {
      const result = await dialog.showMessageBox(null, {
        type: 'question',
        title: 'ÿßŸÑŸÖÿ¨ŸÑÿØ ŸÖŸàÿ¨ŸàÿØ',
        message: `ÿßŸÑŸÖÿ¨ŸÑÿØ ${projectName} ŸÖŸàÿ¨ŸàÿØ ÿ®ÿßŸÑŸÅÿπŸÑ. ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©ÿü`,
        buttons: ['ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©', 'ÿ•ŸÑÿ∫ÿßÿ°'],
        defaultId: 1
      });
      
      if (result.response === 1) return;
    }

    createProgressWindow('ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ PHP', 'ÿ¨ÿßÿ±Ÿä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ...');

    // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ¨ŸÑÿØ
    if (!fs.existsSync(projectPath)) {
      fs.mkdirSync(projectPath, { recursive: true });
    }

    // ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ index.php ŸÖÿπ ŸÖÿ≠ÿ™ŸàŸâ ÿ£ÿ≥ÿßÿ≥Ÿä
    updateProgressWindow('ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅÿßÿ™ PHP...', 30, 'ÿ•ŸÜÿ¥ÿßÿ° index.php');
    const phpContent = `<?php
session_start();
date_default_timezone_set('Asia/Riyadh');

// ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸàŸÇÿπ
$siteName = '${projectName}';
$currentTime = date('Y-m-d H:i:s');
$phpVersion = phpversion();
$serverInfo = $_SERVER['SERVER_SOFTWARE'] ?? 'Unknown';
?>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo $siteName; ?> - ŸÖŸàŸÇÿπ PHP</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 700px;
        }
        
        h1 { color: #333; margin-bottom: 20px; }
        .info-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: right;
        }
        
        .info-card h3 { color: #667eea; margin-bottom: 15px; }
        .info-row { margin: 10px 0; color: #666; }
        .value { font-weight: bold; color: #333; }
        
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä <?php echo $siteName; ?></h1>
        <p>ŸÖŸàŸÇÿπ PHP ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿπŸÖŸÑ!</p>
        
        <div class="info-card">
            <h3>üìä ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿÆÿßÿØŸÖ</h3>
            <div class="info-row">
                <span>ÿ•ÿµÿØÿßÿ± PHP:</span> 
                <span class="value"><?php echo $phpVersion; ?></span>
            </div>
            <div class="info-row">
                <span>ÿßŸÑÿÆÿßÿØŸÖ:</span> 
                <span class="value"><?php echo $serverInfo; ?></span>
            </div>
            <div class="info-row">
                <span>ÿßŸÑŸàŸÇÿ™ ÿßŸÑÿ≠ÿßŸÑŸä:</span> 
                <span class="value"><?php echo $currentTime; ?></span>
            </div>
        </div>
        
        <div class="info-card">
            <h3>üõ†Ô∏è ÿ£ÿØŸàÿßÿ™ ŸÖŸÅŸäÿØÿ©</h3>
            <a href="phpinfo.php" class="btn">ŸÖÿπŸÑŸàŸÖÿßÿ™ PHP</a>
            <a href="test.php" class="btn">ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸàÿ∏ÿßÿ¶ŸÅ</a>
        </div>
        
        <div class="info-card">
            <h3>üìÅ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</h3>
            <div class="info-row">
                <span>ŸÖÿ¨ŸÑÿØ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ:</span> 
                <span class="value"><?php echo __DIR__; ?></span>
            </div>
            <div class="info-row">
                <span>ÿßŸÑÿ±ÿßÿ®ÿ∑:</span> 
                <span class="value">http://${domain}</span>
            </div>
        </div>
    </div>
</body>
</html>`;

    fs.writeFileSync(path.join(projectPath, 'index.php'), phpContent, 'utf8');

    // ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ phpinfo.php
    const phpinfoContent = `<?php
// ŸÖŸÑŸÅ ŸÖÿπŸÑŸàŸÖÿßÿ™ PHP
phpinfo();
?>`;
    fs.writeFileSync(path.join(projectPath, 'phpinfo.php'), phpinfoContent, 'utf8');

    // ÿ•ŸÜÿ¥ÿßÿ° Virtual Host
    updateProgressWindow('ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä...', 60, 'ÿ•ŸÜÿ¥ÿßÿ° Virtual Host');
    addVirtualHost(projectName, 'php');

    // ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ hosts file
    updateProgressWindow('ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿØŸàŸÖŸäŸÜ ÿ•ŸÑŸâ hosts...', 80, 'ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑŸÅ hosts');
    try {
      addToHosts(domain);
    } catch (error) {
      console.warn('Failed to add to hosts file:', error.message);
    }

    updateProgressWindow('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ ÿ®ŸÜÿ¨ÿßÿ≠!', 100, 'ÿ¨ÿßÿ±Ÿä ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàŸÇÿπ...');

    setTimeout(() => {
      closeProgressWindow();
      
      dialog.showMessageBox(null, {
        type: 'info',
        title: 'ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ PHP ÿ®ŸÜÿ¨ÿßÿ≠!',
        message: `ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ PHP ÿ®ŸÜÿ¨ÿßÿ≠!`,
        detail: `ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàŸÇÿπ: ${projectName}\nÿßŸÑŸÖÿ¨ŸÑÿØ: ${projectPath}\nÿßŸÑÿ±ÿßÿ®ÿ∑: http://${domain}`,
        buttons: ['ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàŸÇÿπ', 'ŸÅÿ™ÿ≠ ÿßŸÑŸÖÿ¨ŸÑÿØ', 'ŸÖŸàÿßŸÅŸÇ']
      }).then((result) => {
        if (result.response === 0) {
          shell.openExternal(`http://${domain}`);
        } else if (result.response === 1) {
          shell.openPath(projectPath);
        }
      });
      
      refreshMenu();
      showNotification('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ PHP', `ŸÖŸàŸÇÿπ ${projectName} ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ!`);
      
    }, 1000);

  } catch (error) {
    closeProgressWindow();
    dialog.showErrorBox('ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ', error.message);
  }
}

async function createDatabaseWebsite() {
  try {
    const projectName = await getProjectName('PHP + Database Site');
    if (!projectName) return;

    const projectPath = path.join(baseDir, 'www', projectName);
    const domain = `${projectName}.test`;
    const dbName = `${projectName}_db`;

    // ŸÅÿ≠ÿµ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖÿ¨ŸÑÿØ ŸÖŸàÿ¨ŸàÿØ
    if (fs.existsSync(projectPath)) {
      const result = await dialog.showMessageBox(null, {
        type: 'question',
        title: 'ÿßŸÑŸÖÿ¨ŸÑÿØ ŸÖŸàÿ¨ŸàÿØ',
        message: `ÿßŸÑŸÖÿ¨ŸÑÿØ ${projectName} ŸÖŸàÿ¨ŸàÿØ ÿ®ÿßŸÑŸÅÿπŸÑ. ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©ÿü`,
        buttons: ['ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©', 'ÿ•ŸÑÿ∫ÿßÿ°'],
        defaultId: 1
      });
      
      if (result.response === 1) return;
    }

    createProgressWindow('ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ PHP + ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™', 'ÿ¨ÿßÿ±Ÿä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ...');

    // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ¨ŸÑÿØ
    if (!fs.existsSync(projectPath)) {
      fs.mkdirSync(projectPath, { recursive: true });
    }

    // ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    updateProgressWindow('ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...', 20, `ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: ${dbName}`);
    try {
      await createDatabase(projectName);
    } catch (error) {
      console.warn('Failed to create database:', error.message);
    }

    // ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ config.php ŸÑŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    updateProgressWindow('ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖŸàŸÇÿπ...', 40, 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ ÿßŸÑÿ™ŸÉŸàŸäŸÜ');
    const configContent = `<?php
// ÿ•ÿπÿØÿßÿØÿßÿ™ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
define('DB_HOST', 'localhost');
define('DB_USER', 'root');
define('DB_PASS', '');
define('DB_NAME', '${dbName}');

// ÿßÿ™ÿµÿßŸÑ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
function getDBConnection() {
    try {
        $pdo = new PDO("mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";charset=utf8mb4", DB_USER, DB_PASS);
        $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
        $pdo->setAttribute(PDO::ATTR_DEFAULT_FETCH_MODE, PDO::FETCH_ASSOC);
        return $pdo;
    } catch(PDOException $e) {
        die("ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: " . $e->getMessage());
    }
}

// ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿßÿ≥ÿ™ÿπŸÑÿßŸÖÿßÿ™
function executeQuery($sql, $params = []) {
    $pdo = getDBConnection();
    $stmt = $pdo->prepare($sql);
    $stmt->execute($params);
    return $stmt;
}

// ÿ•ŸÜÿ¥ÿßÿ° ÿ¨ÿØŸàŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸã
function createUsersTable() {
    $sql = "CREATE TABLE IF NOT EXISTS users (
        id INT AUTO_INCREMENT PRIMARY KEY,
        name VARCHAR(100) NOT NULL,
        email VARCHAR(100) UNIQUE NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )";
    
    try {
        executeQuery($sql);
        return true;
    } catch(Exception $e) {
        return false;
    }
}

// ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ¨ÿØŸàŸÑ
createUsersTable();
?>`;

    fs.writeFileSync(path.join(projectPath, 'config.php'), configContent, 'utf8');

    // ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ index.php ŸÖÿπ Ÿàÿßÿ¨Ÿáÿ© ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
    const indexContent = `<?php
require_once 'config.php';
session_start();

// ŸÖÿπÿßŸÑÿ¨ÿ© ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¨ÿØŸäÿØ
if ($_POST['action'] === 'add_user') {
    $name = trim($_POST['name']);
    $email = trim($_POST['email']);
    
    if (!empty($name) && !empty($email)) {
        try {
            executeQuery("INSERT INTO users (name, email) VALUES (?, ?)", [$name, $email]);
            $success = "ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ŸÜÿ¨ÿßÿ≠!";
        } catch(Exception $e) {
            $error = "ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: " . $e->getMessage();
        }
    } else {
        $error = "Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™";
    }
}

// ÿ¨ŸÑÿ® ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
try {
    $users = executeQuery("SELECT * FROM users ORDER BY created_at DESC")->fetchAll();
} catch(Exception $e) {
    $users = [];
    $db_error = "ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: " . $e->getMessage();
}
?>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${projectName} - ŸÖŸàŸÇÿπ PHP + ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1, h2 { color: #333; text-align: center; }
        
        .form-card, .users-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .form-group {
            margin: 15px 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        input[type="text"], input[type="email"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .users-table th, .users-table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }
        
        .users-table th {
            background: #667eea;
            color: white;
        }
        
        .no-users {
            text-align: center;
            color: #666;
            padding: 20px;
        }
        
        .db-info {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            color: #1976d2;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ ${projectName}</h1>
        <p style="text-align: center;">ŸÖŸàŸÇÿπ PHP ŸÖÿ™ÿµŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</p>
        
        <div class="db-info">
            <strong>üìä ŸÖÿπŸÑŸàŸÖÿßÿ™ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:</strong><br>
            ÿßÿ≥ŸÖ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: <strong>${dbName}</strong><br>
            ÿπÿØÿØ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ: <strong><?php echo count($users); ?></strong>
        </div>
        
        <?php if (isset($success)): ?>
            <div class="alert alert-success"><?php echo $success; ?></div>
        <?php endif; ?>
        
        <?php if (isset($error)): ?>
            <div class="alert alert-error"><?php echo $error; ?></div>
        <?php endif; ?>
        
        <div class="form-card">
            <h2>‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¨ÿØŸäÿØ</h2>
            <form method="POST">
                <input type="hidden" name="action" value="add_user">
                
                <div class="form-group">
                    <label for="name">ÿßŸÑÿßÿ≥ŸÖ:</label>
                    <input type="text" id="name" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="email">ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä:</label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <button type="submit" class="btn">ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</button>
            </form>
        </div>
        
        <div class="users-card">
            <h2>üë• ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ</h2>
            
            <?php if (count($users) > 0): ?>
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>ÿßŸÑÿ±ŸÇŸÖ</th>
                            <th>ÿßŸÑÿßÿ≥ŸÖ</th>
                            <th>ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä</th>
                            <th>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($users as $user): ?>
                            <tr>
                                <td><?php echo $user['id']; ?></td>
                                <td><?php echo htmlspecialchars($user['name']); ?></td>
                                <td><?php echo htmlspecialchars($user['email']); ?></td>
                                <td><?php echo date('Y-m-d H:i', strtotime($user['created_at'])); ?></td>
                            </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            <?php else: ?>
                <div class="no-users">
                    üìù ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿ≠ÿ™Ÿâ ÿßŸÑÿ¢ŸÜ<br>
                    ŸÇŸÖ ÿ®ÿ•ÿ∂ÿßŸÅÿ© ÿ£ŸàŸÑ ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ÿ£ÿπŸÑÿßŸá
                </div>
            <?php endif; ?>
        </div>
    </div>
</body>
</html>`;

    fs.writeFileSync(path.join(projectPath, 'index.php'), indexContent, 'utf8');

    // ÿ•ŸÜÿ¥ÿßÿ° Virtual Host
    updateProgressWindow('ÿ•ÿπÿØÿßÿØ ÿßŸÑÿØŸàŸÖŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä...', 70, 'ÿ•ŸÜÿ¥ÿßÿ° Virtual Host');
    addVirtualHost(projectName, 'php');

    // ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ hosts file
    updateProgressWindow('ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿØŸàŸÖŸäŸÜ ÿ•ŸÑŸâ hosts...', 90, 'ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑŸÅ hosts');
    try {
      addToHosts(domain);
    } catch (error) {
      console.warn('Failed to add to hosts file:', error.message);
    }

    updateProgressWindow('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ ÿ®ŸÜÿ¨ÿßÿ≠!', 100, 'ÿ¨ÿßÿ±Ÿä ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàŸÇÿπ...');

    setTimeout(() => {
      closeProgressWindow();
      
      dialog.showMessageBox(null, {
        type: 'info',
        title: 'ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ ÿ®ŸÜÿ¨ÿßÿ≠!',
        message: `ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸàŸÇÿπ PHP + ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!`,
        detail: `ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàŸÇÿπ: ${projectName}\nÿßŸÑŸÖÿ¨ŸÑÿØ: ${projectPath}\nÿßŸÑÿ±ÿßÿ®ÿ∑: http://${domain}\nŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: ${dbName}`,
        buttons: ['ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàŸÇÿπ', 'ŸÅÿ™ÿ≠ ÿßŸÑŸÖÿ¨ŸÑÿØ', 'ŸÖŸàÿßŸÅŸÇ']
      }).then((result) => {
        if (result.response === 0) {
          shell.openExternal(`http://${domain}`);
        } else if (result.response === 1) {
          shell.openPath(projectPath);
        }
      });
      
      refreshMenu();
      showNotification('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ', `ŸÖŸàŸÇÿπ ${projectName} ŸÖÿπ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ¨ÿßŸáÿ≤!`);
      
    }, 1000);

  } catch (error) {
    closeProgressWindow();
    dialog.showErrorBox('ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸàŸÇÿπ', error.message);
  }
}

// Initialize the tray icon and menu
function createTray() {
  // ÿ™ŸÜÿ∏ŸäŸÅ httpd.conf ŸÖŸÜ ÿ£Ÿä Include statements ÿÆÿßÿ∑ÿ¶ÿ© ÿπŸÜÿØ ÿ®ÿØÿ° ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨
  cleanupHttpdConf();
  
  // ÿ•ÿπÿØÿßÿØ ŸÖÿ±ÿßŸÇÿ® ŸÑŸÖŸÑŸÅ httpd.conf ŸÑŸÖŸÜÿπ ÿ•ÿ∂ÿßŸÅÿ© Include statements ÿÆÿßÿ∑ÿ¶ÿ©
  setupHttpdConfWatcher();
  
  // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
  loadSettings();
  
  // ÿ•ÿπÿØÿßÿØ IPC handlers
  setupIpcHandlers();
  
  const tray = new Tray(path.join(baseDir, 'assets', 'icon.png'));
  tray.setToolTip('MyDevBox');
  
  // ÿ™ÿÆÿ≤ŸäŸÜ tray ŸÅŸä global ŸÑŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸäŸá ŸÖŸÜ refreshMenu
  global.appTray = tray;
  
  refreshMenu();
  return tray;
}

module.exports = {
  createTray,
  createSimpleWebsite,
  createPHPWebsite,
  createDatabaseWebsite,
  stopAll: () => {
    stopService('apache');
    stopService('mysql');
  }
};